# {{medicalDomainIcon medical_domain}} {{table_name}} - Detalles TÃ©cnicos

**{{medicalDomainName medical_domain}}** | **Esquema**: `{{table_schema}}` | **Tipo**: {{table_type}}

{{#if table_comment}}
> ğŸ“ **DescripciÃ³n**: {{table_comment}}
{{/if}}

---

## ğŸ¯ PropÃ³sito MÃ©dico

{{table_purpose}}

{{#if hipaa_classification}}
---

## ğŸ”’ ClasificaciÃ³n HIPAA

### {{hipaaLevelIcon hipaa_classification.overall_sensitivity}} Nivel de Sensibilidad: {{hipaaLevelName hipaa_classification.overall_sensitivity}}

{{#if hipaa_classification.contains_phi}}
| **Aspecto** | **Estado** | **Detalles** |
|-------------|------------|--------------|
| **Contiene PHI** | {{hipaaLevelIcon hipaa_classification.overall_sensitivity}} SÃ­ | {{hipaa_classification.phi_column_count}} columnas clasificadas |
| **Control de Acceso** | ğŸ” | {{hipaa_classification.access_control_level}} |
| **AuditorÃ­a** | ğŸ“Š | {{hipaa_classification.audit_requirements}} |
| **EncriptaciÃ³n** | ğŸ”’ | {{hipaa_classification.encryption_requirements}} |
| **RetenciÃ³n** | ğŸ“… | {{hipaa_classification.retention_category}} |
{{else}}
âœ… **Esta tabla NO contiene informaciÃ³n mÃ©dica protegida (PHI)**
{{/if}}

{{/if}}

---

## ğŸ“Š Estructura de Columnas

| **Columna** | **Tipo** | **Nulo** | **PK** | **FK** | **Por Defecto** | **HIPAA** | **PropÃ³sito** |
|-------------|----------|----------|--------|--------|-----------------|-----------|---------------|
{{#each columns}}
| {{inlineCode column_name}} | {{postgresTypeIcon data_type}} {{data_type}} | {{#if is_nullable}}âœ…{{else}}âŒ{{/if}} | {{#if is_primary_key}}ğŸ”‘{{else}}-{{/if}} | {{#if is_foreign_key}}ğŸ”—{{else}}-{{/if}} | {{default column_default "-"}} | {{#if hipaa_annotation}}{{hipaaLevelIcon hipaa_annotation.sensitivity_level}}{{else}}-{{/if}} | {{default medical_purpose description}} |
{{/each}}

---

## ğŸ“‹ Detalles de Columnas

{{#each columns}}
### {{postgresTypeIcon data_type}} `{{column_name}}`

**Tipo**: {{data_type}}{{#if character_maximum_length}} ({{character_maximum_length}}){{/if}}
**DescripciÃ³n**: {{default description "Sin descripciÃ³n disponible"}}

{{#if medical_purpose}}
**ğŸ¥ PropÃ³sito MÃ©dico**: {{medical_purpose}}
{{/if}}

{{#if validation_rules}}
**ğŸ“ Reglas de ValidaciÃ³n**:
{{#each validation_rules}}
- {{this}}
{{/each}}
{{/if}}

{{#if example_values}}
**ğŸ’¡ Valores Ejemplo**: {{join example_values ", "}}
{{/if}}

{{#if hipaa_annotation}}
#### ğŸ”’ ClasificaciÃ³n HIPAA

| **Aspecto** | **Valor** |
|-------------|-----------|
| **Nivel de Sensibilidad** | {{hipaaLevelIcon hipaa_annotation.sensitivity_level}} {{hipaaLevelName hipaa_annotation.sensitivity_level}} |
| **Contiene PHI** | {{#if hipaa_annotation.contains_phi}}âœ… SÃ­{{else}}âŒ No{{/if}} |
| **CategorÃ­as de Datos** | {{join hipaa_annotation.data_categories ", "}} |
| **EncriptaciÃ³n Requerida** | {{#if hipaa_annotation.encryption_required}}ğŸ”’ SÃ­{{else}}ğŸŒ No{{/if}} |
| **AuditorÃ­a Requerida** | {{#if hipaa_annotation.audit_required}}ğŸ“Š SÃ­{{else}}ğŸ“„ No{{/if}} |
| **Ãšltima RevisiÃ³n** | {{formatDate hipaa_annotation.last_reviewed}} |
| **Revisado Por** | {{hipaa_annotation.reviewed_by}} |

{{#if hipaa_annotation.access_requirements}}
##### ğŸ›¡ï¸ Requisitos de Acceso
{{#each hipaa_annotation.access_requirements}}
- **{{requirement_type}}**: {{description}}
  {{#if required_roles}}- Roles: {{join required_roles ", "}}{{/if}}
  {{#if mfa_required}}- MFA Requerido: âœ…{{/if}}
  - Nivel de AuditorÃ­a: {{audit_level}}
{{/each}}
{{/if}}

{{#if hipaa_annotation.retention_policy}}
##### ğŸ“… PolÃ­tica de RetenciÃ³n
- **PerÃ­odo**: {{hipaa_annotation.retention_policy.retention_period_years}} aÃ±os
- **MÃ©todo de EliminaciÃ³n**: {{hipaa_annotation.retention_policy.deletion_method}}
- **Derechos del Paciente**: {{#if hipaa_annotation.retention_policy.patient_access_rights}}âœ…{{else}}âŒ{{/if}}
- **Derecho de Enmienda**: {{#if hipaa_annotation.retention_policy.amendment_rights}}âœ…{{else}}âŒ{{/if}}
{{/if}}

{{#if hipaa_annotation.compliance_notes}}
##### ğŸ“ Notas de Cumplimiento
{{hipaa_annotation.compliance_notes}}
{{/if}}

{{/if}}

{{#if related_columns}}
#### ğŸ”— Columnas Relacionadas
{{#each related_columns}}
- {{inlineCode this}}
{{/each}}
{{/if}}

{{#if business_logic}}
#### ğŸ’¼ LÃ³gica de Negocio
{{business_logic}}
{{/if}}

---

{{/each}}

{{#if relationships}}
---

## ğŸ”— Relaciones con Otras Tablas

{{#each relationships}}
### {{#ifEquals relationship_type "ONE_TO_ONE"}}1:1{{/ifEquals}}{{#ifEquals relationship_type "ONE_TO_MANY"}}1:N{{/ifEquals}}{{#ifEquals relationship_type "MANY_TO_MANY"}}N:N{{/ifEquals}} - {{inlineCode related_table}}

**Tipo**: {{relationship_type}}
**Columnas FK**: {{join foreign_key_columns ", "}}
**PropÃ³sito**: {{relationship_purpose}}

{{#if cardinality_notes}}
**Notas de Cardinalidad**: {{cardinality_notes}}
{{/if}}

{{/each}}

{{/if}}

{{#if indexes}}
---

## ğŸ“ˆ Ãndices de Rendimiento

{{#each indexes}}
### {{#if is_unique}}ğŸ”‘{{else}}ğŸ“Š{{/if}} `{{index_name}}`

| **Aspecto** | **Valor** |
|-------------|-----------|
| **Tipo** | {{index_type}} |
| **Columnas** | {{join columns ", "}} |
| **Ãšnico** | {{#if is_unique}}âœ… SÃ­{{else}}âŒ No{{/if}} |
| **PropÃ³sito** | {{performance_purpose}} |

{{#if query_patterns}}
**ğŸ” Patrones de Consulta Optimizados**:
{{#each query_patterns}}
```sql
{{this}}
```
{{/each}}
{{/if}}

{{#if maintenance_notes}}
**ğŸ”§ Notas de Mantenimiento**: {{maintenance_notes}}
{{/if}}

---

{{/each}}

{{/if}}

{{#if constraints}}
---

## âš–ï¸ Restricciones y Reglas de Negocio

{{#each constraints}}
### `{{constraint_name}}`

| **Aspecto** | **Valor** |
|-------------|-----------|
| **Tipo** | {{constraint_type}} |
| **Columnas** | {{join columns ", "}} |
| **Nivel de AplicaciÃ³n** | {{enforcement_level}} |
| **Regla de Negocio** | {{business_rule}} |

{{#if validation_examples}}
**âœ… Ejemplos de ValidaciÃ³n**:
{{#each validation_examples}}
```sql
{{this}}
```
{{/each}}
{{/if}}

---

{{/each}}

{{/if}}

{{#if sample_queries}}
---

## ğŸ’» Consultas de Ejemplo

{{#each sample_queries}}
### Ejemplo {{add @index 1}}

```sql
{{this}}
```

---

{{/each}}

{{/if}}

{{#if migration_history}}
---

## ğŸ“š Historial de Migraciones

{{#each migration_history}}
### {{migration_name}}

**Aplicado**: {{formatDate applied_at}}
**Rollback Disponible**: {{#if rollback_available}}âœ…{{else}}âŒ{{/if}}

**Cambios**:
{{#each changes}}
- {{this}}
{{/each}}

---

{{/each}}

{{/if}}

---

## ğŸ” InformaciÃ³n TÃ©cnica

### ğŸ“Š EstadÃ­sticas

| **MÃ©trica** | **Valor** |
|-------------|-----------|
| **Total de Columnas** | {{length columns}} |
| **Columnas Requeridas** | {{#each columns}}{{#if is_required}}{{add @index 1}}{{/if}}{{/each}} |
| **Claves Primarias** | {{#each columns}}{{#if is_primary_key}}{{add @index 1}}{{/if}}{{/each}} |
| **Claves ForÃ¡neas** | {{#each columns}}{{#if is_foreign_key}}{{add @index 1}}{{/if}}{{/each}} |
| **Ãndices** | {{length indexes}} |
| **Restricciones** | {{length constraints}} |
| **Relaciones** | {{length relationships}} |

### ğŸ”’ Resumen de Seguridad

{{#if hipaa_classification}}
- **Nivel HIPAA**: {{hipaaLevelIcon hipaa_classification.overall_sensitivity}} {{hipaaLevelName hipaa_classification.overall_sensitivity}}
- **Columnas con PHI**: {{#if hipaa_classification.contains_phi}}{{hipaa_classification.phi_column_count}}{{else}}0{{/if}}
- **Control de Acceso**: {{hipaa_classification.access_control_level}}
- **AuditorÃ­a**: {{hipaa_classification.audit_requirements}}
{{else}}
- **Estado HIPAA**: â“ Sin clasificar
- **RecomendaciÃ³n**: Realizar revisiÃ³n de cumplimiento
{{/if}}

### ğŸ¯ Recomendaciones

{{#unless hipaa_classification}}
{{alert "warning" "Esta tabla requiere clasificaciÃ³n HIPAA. Revisar contenido de datos mÃ©dicos."}}
{{/unless}}

{{#ifEquals hipaa_classification.access_control_level "PUBLIC"}}
{{alert "info" "Verificar que el acceso pÃºblico sea apropiado para todos los datos en esta tabla."}}
{{/ifEquals}}

{{#if hipaa_classification.contains_phi}}
{{#unless hipaa_classification.encryption_requirements}}
{{alert "error" "Tabla contiene PHI pero no tiene requisitos de encriptaciÃ³n definidos."}}
{{/unless}}
{{/if}}

{{#ifGreaterThan (length columns) 50}}
{{alert "warning" "Tabla con muchas columnas. Considerar normalizaciÃ³n o particionamiento."}}
{{/ifGreaterThan}}

{{#unless indexes}}
{{alert "info" "Tabla sin Ã­ndices definidos. Evaluar necesidades de rendimiento."}}
{{/unless}}

---

**ğŸ“… Documento generado**: {{formatDate "now"}}
**ğŸ”„ Ãšltima actualizaciÃ³n de esquema**: {{formatDate ../database_info.last_migration}}
**ğŸ“Š Fuente**: {{../database_info.introspection_method}}