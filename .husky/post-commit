#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ðŸ§ª Post-commit QA rÃ¡pido..."

# Correr en background con timeout de 30 segundos
(
  # Timeout despuÃ©s de 30 segundos
  timeout 30s bash << 'INNEREOF'
    export NODE_OPTIONS="--max-old-space-size=4096"

    # Solo lint el Ãºltimo commit (mucho mÃ¡s rÃ¡pido)
    LAST_COMMIT_FILES=$(git diff-tree --no-commit-id --name-only -r HEAD | grep -E '\.(ts|tsx|js|jsx)$' | head -20)

    if [ -n "$LAST_COMMIT_FILES" ]; then
      echo "$LAST_COMMIT_FILES" | xargs npx eslint --cache --quiet 2>&1 | head -50 || true
    fi

    echo "âœ… Post-commit QA completado"
INNEREOF
) &

# No esperar al background job
echo "âš¡ QA corriendo en background (max 30s)"
