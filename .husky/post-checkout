#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Auto-sync Claude Code agents after checkout
# Useful when switching branches with different agent configs

PREV_HEAD=$1
NEW_HEAD=$2
BRANCH_CHECKOUT=$3

# Only run on branch checkout (not file checkout)
if [ "$BRANCH_CHECKOUT" = "1" ]; then
  echo "ü§ñ Checking Claude Code agents..."

  # Check if agentic-config.json differs between commits
  if git diff --name-only $PREV_HEAD $NEW_HEAD | grep -q "\.claude/agentic-config.json"; then
    echo "üìù Agent config changed, re-registering agents..."
    node scripts/register-claude-agents.mjs
    # Registrar tambi√©n agentes para ChatGPT/OpenAI
    node scripts/register-openai-agents.mjs || echo "‚ö†Ô∏è  OpenAI agents sync failed"
    echo "‚úÖ Agents synchronized!"
  else
    echo "‚ÑπÔ∏è  No agent config changes detected"
  fi
fi
