(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[769],{2941:(e,r,o)=>{Promise.resolve().then(o.bind(o,2980))},2980:(e,r,o)=>{"use strict";o.r(r),o.d(r,{default:()=>c});var s=o(3919),t=o(1111),a=o(4336),n=o(3842);function c(){let e=(0,a.useRouter)();return(0,t.useEffect)(()=>{(async()=>{var r,o;console.log("\uD83D\uDD10 OAuth Callback Page - Processing OAuth callback...");let s=(0,n.UU)();if(!s){console.error("Failed to create Supabase client"),e.push("/auth/login?error=client_failed");return}let t=new URLSearchParams(window.location.search).get("code");if(t){console.log("\uD83D\uDCE6 PKCE flow detected - exchanging code for session...");try{let{data:o,error:a}=await s.auth.exchangeCodeForSession(t);if(a){console.error("Failed to exchange code:",a),e.push("/auth/login?error=".concat(encodeURIComponent(a.message)));return}console.log("✅ Session established successfully");let{data:{user:n}}=await s.auth.getUser();if(n){let o=null==(r=n.user_metadata)?void 0:r.role;switch(console.log("User role:",o),o){case"doctor":window.location.href="https://autamedica-doctors.pages.dev";break;case"patient":window.location.href="https://autamedica-patients.pages.dev";break;case"company":window.location.href="https://autamedica-companies.pages.dev";break;default:e.push("/auth/select-role")}}else e.push("/auth/select-role");return}catch(r){console.error("Unexpected error during code exchange:",r),e.push("/auth/login?error=exchange_failed");return}}let a=new URLSearchParams(window.location.hash.substring(1)),c=a.get("access_token"),i=a.get("refresh_token"),l=a.get("error"),u=a.get("error_description");if(l){console.error("OAuth error:",l,u),e.push("/auth/login?error=".concat(encodeURIComponent(l)));return}if(c){console.log("✅ Tokens found, setting session..."),console.log("Access token length:",c.length),console.log("Refresh token:",i?"present":"missing");let r=(0,n.UU)();if(!r){console.error("Failed to create Supabase client"),e.push("/auth/login?error=client_failed");return}try{let{data:o,error:s}=await r.auth.getUser(c);if(s&&(console.error("Token validation failed:",s),!i)){console.error("No refresh token available"),e.push("/auth/login?error=missing_refresh_token");return}let{data:t,error:a}=await r.auth.setSession({access_token:c,refresh_token:i||""});if(a){console.error("Failed to set session:",a),console.error("Session error details:",{message:a.message,status:a.status,code:a.code}),e.push("/auth/login?error=session_failed");return}}catch(r){console.error("Unexpected error during session setup:",r),e.push("/auth/login?error=unexpected_error");return}console.log("✅ Session set successfully");let{data:{user:s}}=await r.auth.getUser();if(s){let r=null==(o=s.user_metadata)?void 0:o.role;switch(console.log("User role:",r),r){case"doctor":e.push("/doctors");break;case"patient":e.push("/patients");break;case"company":e.push("/companies");break;default:e.push("/auth/select-role")}}else e.push("/auth/select-role")}else console.error("No tokens found in URL"),e.push("/auth/login?error=no_tokens")})()},[e]),(0,s.jsx)("div",{className:"min-h-screen bg-black flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"w-16 h-16 border-4 border-gray-600 border-t-white rounded-full animate-spin mx-auto mb-4"}),(0,s.jsx)("div",{className:"text-white text-lg",children:"Procesando autenticaci\xf3n..."})]})})}},3842:(e,r,o)=>{"use strict";o.d(r,{UU:()=>t});var s=o(3427);function t(){let e="https://gtyvdircfhmdjiaelqkg.supabase.co",r="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd0eXZkaXJjZmhtZGppYWVscWtnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY2Njc4NTUsImV4cCI6MjA3MjI0Mzg1NX0.DeEm08k7QOrKObWaz8AUaOB5N6Z2QZhZHFaUf2siALA";return e&&r?(0,s.createBrowserClient)(e,r):(console.error("Supabase configuration error: Invalid URL or key"),(0,s.createBrowserClient)("https://gtyvdircfhmdjiaelqkg.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd0eXZkaXJjZmhtZGppYWVscWtnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYyOTI3OTAsImV4cCI6MjA3MTg2ODc5MH0.7UFMVZsWTWOAynnhzkG76I_lhVCYtd_RmTt9EH3wJD4"))}o(4444)}},e=>{e.O(0,[66,554,829,358],()=>e(e.s=2941)),_N_E=e.O()}]);