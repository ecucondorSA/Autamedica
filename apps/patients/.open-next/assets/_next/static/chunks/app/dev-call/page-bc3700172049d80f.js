(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[329],{47:(e,a,t)=>{"use strict";t.d(a,{A:()=>r});let r=(0,t(9336).A)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},924:(e,a,t)=>{"use strict";t.d(a,{A:()=>r});let r=(0,t(9336).A)("PhoneOff",[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]])},979:(e,a,t)=>{"use strict";t.d(a,{A:()=>r});let r=(0,t(9336).A)("VideoOff",[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.5l5.248-3.062A.5.5 0 0 1 22 7.87v8.196",key:"w8jjjt"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2",key:"1xawa7"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]])},2272:(e,a,t)=>{"use strict";t.d(a,{A:()=>r});let r=(0,t(9336).A)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},3117:(e,a,t)=>{"use strict";t.d(a,{A:()=>r});let r=(0,t(9336).A)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},3492:(e,a,t)=>{"use strict";t.d(a,{A:()=>r});let r=(0,t(9336).A)("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]])},3819:(e,a,t)=>{"use strict";t.d(a,{A:()=>r});let r=(0,t(9336).A)("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]])},4336:(e,a,t)=>{"use strict";var r=t(3104);t.o(r,"usePathname")&&t.d(a,{usePathname:function(){return r.usePathname}}),t.o(r,"useRouter")&&t.d(a,{useRouter:function(){return r.useRouter}}),t.o(r,"useSearchParams")&&t.d(a,{useSearchParams:function(){return r.useSearchParams}})},4962:(e,a,t)=>{"use strict";t.d(a,{A:()=>r});let r=(0,t(9336).A)("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]])},5319:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>k});var r=t(3919),s=t(1111),n=t(4336),c=t(6730),l=t(3117),i=t(9336);let o=(0,i.A)("PhoneIncoming",[["polyline",{points:"16 2 16 8 22 8",key:"1ygljm"}],["line",{x1:"22",x2:"16",y1:"2",y2:"8",key:"1xzwqn"}],["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);var d=t(8348),u=t(2272),m=t(924),h=t(979),x=t(5887),g=t(3492),p=t(3819),y=t(47),f=t(9843),v=t(4962);let b=(0,i.A)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);function j(e){let{onMediaReady:a,onError:t}=e,[n,c]=(0,s.useState)([]),[l,i]=(0,s.useState)([]),[o,d]=(0,s.useState)(""),[u,m]=(0,s.useState)(""),[h,x]=(0,s.useState)(!1),[p,y]=(0,s.useState)(""),[j,w]=(0,s.useState)(!1);(0,s.useEffect)(()=>{{let e=localStorage.getItem("am_video_device"),a=localStorage.getItem("am_audio_device");e&&d(e),a&&m(a)}},[]);let N=async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then(e=>e.getTracks().forEach(e=>e.stop())).catch(()=>{});let e=await navigator.mediaDevices.enumerateDevices(),a=e.filter(e=>"videoinput"===e.kind),t=e.filter(e=>"audioinput"===e.kind);c(a),i(t),!o&&a.length>0&&d(a[0].deviceId),!u&&t.length>0&&m(t[0].deviceId)}catch(e){console.error("Error enumerating devices:",e),y("No se pudieron detectar dispositivos")}};(0,s.useEffect)(()=>(N(),navigator.mediaDevices.addEventListener("devicechange",N),()=>{navigator.mediaDevices.removeEventListener("devicechange",N)}),[]);let k=async()=>{for(let e of(x(!0),y(""),[{audio:!u||{deviceId:{exact:u}},video:!o||{deviceId:{exact:o}}},{audio:!0,video:!0},{audio:!0,video:{width:{ideal:640},height:{ideal:480}}},{audio:!0,video:{facingMode:"user"}},{audio:!0,video:!1}]))try{let t=await navigator.mediaDevices.getUserMedia(e);o&&localStorage.setItem("am_video_device",o),u&&localStorage.setItem("am_audio_device",u),a(t),x(!1),y("");return}catch(a){if(console.error("Failed with constraint:",e,a),"OverconstrainedError"===a.name||"NotFoundError"===a.name)continue;if("AbortError"===a.name||"NotReadableError"===a.name){y("La c\xe1mara est\xe1 siendo usada por otra aplicaci\xf3n");continue}}y("No se pudo acceder a la c\xe1mara/micr\xf3fono"),x(!1),null==t||t(Error("Media access failed"))},A=async()=>{x(!0),y("");try{let e=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!1});if(u)try{(await navigator.mediaDevices.getUserMedia({audio:!u||{deviceId:{exact:u}},video:!1})).getAudioTracks().forEach(a=>{e.addTrack(a)})}catch(e){}a(e),x(!1),y("")}catch(e){y("No se pudo compartir la pantalla"),x(!1),null==t||t(e)}};return(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-4 space-y-4",children:[(0,r.jsx)("h3",{className:"font-semibold text-gray-800",children:"Configuraci\xf3n de Medios"}),p&&(0,r.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-3 py-2 rounded text-sm",children:p}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[(0,r.jsx)(f.A,{className:"inline w-4 h-4 mr-1"}),"C\xe1mara"]}),(0,r.jsxs)("select",{value:o,onChange:e=>d(e.target.value),disabled:j||0===n.length,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,r.jsx)("option",{value:"",children:"Seleccionar c\xe1mara..."}),n.map(e=>(0,r.jsx)("option",{value:e.deviceId,children:e.label||"C\xe1mara ".concat(e.deviceId.substring(0,8))},e.deviceId))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[(0,r.jsx)(g.A,{className:"inline w-4 h-4 mr-1"}),"Micr\xf3fono"]}),(0,r.jsxs)("select",{value:u,onChange:e=>m(e.target.value),disabled:0===l.length,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,r.jsx)("option",{value:"",children:"Seleccionar micr\xf3fono..."}),l.map(e=>(0,r.jsx)("option",{value:e.deviceId,children:e.label||"Micr\xf3fono ".concat(e.deviceId.substring(0,8))},e.deviceId))]})]})]}),(0,r.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,r.jsx)("input",{type:"checkbox",checked:j,onChange:e=>w(e.target.checked),className:"rounded"}),(0,r.jsx)(v.A,{className:"w-4 h-4"}),"Usar compartir pantalla en lugar de c\xe1mara"]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:j?A:k,disabled:h,className:"flex-1 px-4 py-2 rounded-md text-white font-medium transition-colors ".concat(h?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"),children:h?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(b,{className:"inline w-4 h-4 mr-2 animate-spin"}),"Conectando..."]}):j?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(v.A,{className:"inline w-4 h-4 mr-2"}),"Compartir Pantalla"]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(f.A,{className:"inline w-4 h-4 mr-2"}),"Activar C\xe1mara"]})}),(0,r.jsx)("button",{onClick:N,className:"px-3 py-2 border border-gray-300 rounded-md hover:bg-gray-50",title:"Recargar dispositivos",children:(0,r.jsx)(b,{className:"w-4 h-4"})})]}),(0,r.jsx)("div",{className:"text-center",children:(0,r.jsxs)("button",{onClick:()=>{(async()=>{x(!0),y("");try{let e=await navigator.mediaDevices.getUserMedia({audio:!u||{deviceId:{exact:u}},video:!1});a(e),x(!1)}catch(e){y("No se pudo acceder al micr\xf3fono"),x(!1),null==t||t(e)}})()},disabled:h,className:"text-sm text-gray-600 hover:text-blue-600 underline",children:[(0,r.jsx)(g.A,{className:"inline w-4 h-4 mr-1"}),"Continuar solo con audio (sin video)"]})}),(0,r.jsx)("div",{className:"text-xs text-gray-500",children:0===n.length&&0===l.length?(0,r.jsx)("p",{children:"No se detectaron dispositivos. Verifica los permisos del navegador."}):(0,r.jsx)("p",{children:"Si la c\xe1mara falla, intenta: 1) Cerrar otras apps que la usen, 2) Usar compartir pantalla, 3) Reiniciar el navegador"})})]})}function w(e){let{roomId:a,patientName:t="Paciente"}=e,[n,i]=(0,s.useState)("waiting"),[f,v]=(0,s.useState)(!1),[b,w]=(0,s.useState)(!1),[N,k]=(0,s.useState)(0),[A,C]=(0,s.useState)(null),[S,E]=(0,s.useState)(null),[T,I]=(0,s.useState)("Dr. Garc\xeda"),[M,P]=(0,s.useState)(!1),[O,R]=(0,s.useState)(!1),[D]=(0,s.useState)(()=>{let e=sessionStorage.getItem("patientUserId");if(e)return e;let a="patient-".concat(Date.now(),"-").concat(Math.random().toString(36).substring(7));return sessionStorage.setItem("patientUserId",a),a}),[L,z]=(0,s.useState)(null),_=(0,s.useRef)(null),V=(0,s.useRef)(null),q=(0,s.useRef)(null),U=(0,s.useRef)(null),F=(0,s.useRef)(null),J=(0,s.useRef)(new Set),H=(0,s.useRef)([]);(0,s.useEffect)(()=>{let e=V.current;e&&(e.srcObject=S,S&&e.play().catch(()=>{}))},[S,n]),(0,s.useEffect)(()=>{let e="http://localhost:8787",t=null,r=!0;return(async()=>{if(r)try{(await fetch("".concat(e,"/api/join"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:D,roomId:a,userType:"patient"})})).ok&&r&&(t&&clearInterval(t),t=setInterval(async()=>{if(r)try{let n=await fetch("".concat(e,"/api/poll?userId=").concat(D,"&roomId=").concat(a));if(n.ok&&r){let e=await n.json();if(e.messages&&e.messages.length>0)for(let a of e.messages){var t,s;if(a.from===D||"user-joined"===a.type||"user-left"===a.type)continue;let e="".concat(a.type,"-").concat(a.from,"-").concat(a.timestamp);if(!J.current.has(e)){if(J.current.add(e),J.current.size>100){let e=Array.from(J.current);J.current=new Set(e.slice(-50))}if("incoming-call"===a.type&&(i("incoming"),I((null==(t=a.data)?void 0:t.doctorName)||"Dr. Garc\xeda"),$()),"webrtc-offer"===a.type&&z(a.data.offer),"ice-candidate"===a.type&&F.current){if(!(null==(s=a.data)?void 0:s.candidate)){console.warn("ICE candidate payload missing candidate data");continue}try{let e=F.current,t=a.data.candidate;e.remoteDescription?await e.addIceCandidate(new RTCIceCandidate(t)):H.current.push(t)}catch(e){console.error("Failed to add ICE candidate:",e)}}"call-ended"===a.type&&Y()}}}}catch(e){console.error("Error en polling:",e)}},1e3))}catch(e){console.error("Error al unirse a la sala:",e)}})(),()=>{r=!1,t&&clearInterval(t),fetch("".concat(e,"/api/leave"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:D,roomId:a})}).catch(console.error),F.current&&(F.current.close(),F.current=null)}},[a,D]);let G=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});return C(e),R(!1),_.current&&(_.current.srcObject=e),e}catch(e){console.error("Error al acceder a la c\xe1mara:",e),R(!0),P(!0);try{let e=await navigator.mediaDevices.getUserMedia({video:!1,audio:!0});return C(e),R(!1),_.current&&(_.current.srcObject=e),e}catch(e){return console.error("Failed to get even audio:",e),null}}};(0,s.useEffect)(()=>()=>{A&&A.getTracks().forEach(e=>e.stop()),S&&S.getTracks().forEach(e=>e.stop())},[A,S]);let W=(0,s.useCallback)(()=>{q.current||(q.current=setInterval(()=>{k(e=>e+1)},1e3))},[]),Z=(0,s.useCallback)(()=>{q.current&&(clearInterval(q.current),q.current=null),k(0)},[]),$=()=>{let e=new(window.AudioContext||window.webkitAudioContext),a=e.createOscillator(),t=e.createGain();a.connect(t),t.connect(e.destination),a.frequency.value=440,a.type="sine",t.gain.value=.3,a.start(),setTimeout(()=>a.stop(),500)},B=(0,s.useCallback)(async e=>{let t=F.current;if(!t)return void console.warn("processOffer called but no peer connection is ready yet");if(!t.currentRemoteDescription)try{if(await t.setRemoteDescription(new RTCSessionDescription(e)),H.current.length){let e=[...H.current];for(let a of(H.current.length=0,e))try{await t.addIceCandidate(new RTCIceCandidate(a))}catch(e){console.error("Failed to add queued ICE candidate:",e)}}let r=await t.createAnswer();await t.setLocalDescription(r);let s=t.localDescription;if(!s)throw Error("Local description missing after setLocalDescription");await fetch("".concat("http://localhost:8787","/api/message"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({from:D,roomId:a,type:"webrtc-answer",data:{answer:s}})}),i("connected"),W(),z(null)}catch(e){console.error("Error processing offer:",e),R(!0),P(!0)}},[a,W,D]),X=async()=>{ee(),i("connecting");try{let e=A;if(e||(e=await G()),!e)throw Error("No media stream available after initialization");let t=(()=>{F.current&&(F.current.close(),F.current=null),H.current.length=0;let e=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});return e.ontrack=e=>{var a;(null==(a=e.streams)?void 0:a[0])&&(E(e.streams[0]),V.current&&(V.current.srcObject=e.streams[0]))},e.onicecandidate=async e=>{if(e.candidate)try{await fetch("".concat("http://localhost:8787","/api/message"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({from:D,roomId:a,type:"ice-candidate",data:{candidate:e.candidate}})})}catch(e){console.error("Error sending ICE candidate:",e)}},e.onconnectionstatechange=()=>{"failed"===e.connectionState&&(console.error("WebRTC connection failed"),R(!0))},F.current=e,e})();e.getTracks().forEach(a=>{t.addTrack(a,e)}),await fetch("".concat("http://localhost:8787","/api/message"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({from:D,roomId:a,type:"patient-joined",data:{}})}),L&&await B(L)}catch(e){console.error("Error al aceptar llamada:",e),R(!0),P(!0),F.current&&(F.current.close(),F.current=null),i("incoming")}};(0,s.useEffect)(()=>{"connecting"===n&&L&&B(L)},[n,L,B]);let K=async()=>{ee(),i("waiting");try{await fetch("".concat("http://localhost:8787","/api/message"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({from:D,roomId:a,type:"call-rejected",data:{}})})}catch(e){console.error("Error al rechazar llamada:",e)}},Q=async()=>{Y();try{await fetch("".concat("http://localhost:8787","/api/message"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({from:D,roomId:a,type:"call-ended",data:{}})})}catch(e){console.error("Error al finalizar llamada:",e)}},Y=()=>{i("ended"),Z(),ee(),F.current&&(F.current.close(),F.current=null),A&&A.getTracks().forEach(e=>e.stop()),S&&S.getTracks().forEach(e=>e.stop()),E(null),V.current&&(V.current.srcObject=null),setTimeout(()=>{i("waiting"),C(null),z(null)},2e3)},ee=()=>{U.current&&(U.current.pause(),U.current.currentTime=0)};return(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6",children:(0,r.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,r.jsxs)("div",{className:"mb-6 flex justify-between items-start",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-800 mb-2",children:"Portal del Paciente"}),(0,r.jsxs)("div",{className:"flex items-center gap-4 text-gray-600",children:[(0,r.jsxs)("span",{children:["Sala de espera: ",a]}),"connected"===n&&(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)(c.A,{className:"w-4 h-4"}),(e=>{let a=Math.floor(e/60);return"".concat(a.toString().padStart(2,"0"),":").concat((e%60).toString().padStart(2,"0"))})(N)]})]})]}),"waiting"===n&&(0,r.jsx)("button",{onClick:()=>P(!M),className:"p-2 bg-white rounded-lg shadow hover:shadow-md transition-shadow",title:"Configurar c\xe1mara y micr\xf3fono",children:(0,r.jsx)(l.A,{className:"w-5 h-5 text-gray-600"})})]}),M&&(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsx)(j,{onMediaReady:e=>{C(e),R(!1),P(!1),_.current&&(_.current.srcObject=e),F.current&&e&&e.getTracks().forEach(a=>{F.current.addTrack(a,e)})},onError:e=>{console.error("MediaPicker error:",e),R(!0)}})}),"incoming"===n&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center",children:(0,r.jsx)("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full mx-4 animate-bounce",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsx)("div",{className:"w-24 h-24 bg-green-100 rounded-full mx-auto flex items-center justify-center animate-pulse",children:(0,r.jsx)(o,{className:"w-12 h-12 text-green-600 animate-bounce"})})}),(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Llamada entrante"}),(0,r.jsxs)("p",{className:"text-lg text-gray-600 mb-6",children:[T," te est\xe1 llamando"]}),(0,r.jsxs)("div",{className:"flex gap-4 justify-center",children:[(0,r.jsxs)("button",{onClick:X,className:"bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg flex items-center gap-2 transition-colors",children:[(0,r.jsx)(d.A,{className:"w-5 h-5"}),"Aceptar"]}),(0,r.jsxs)("button",{onClick:K,className:"bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg flex items-center gap-2 transition-colors",children:[(0,r.jsx)(u.A,{className:"w-5 h-5"}),"Rechazar"]})]}),O&&(0,r.jsx)("div",{className:"mt-4 text-sm text-orange-600",children:"⚠️ Problema con la c\xe1mara. Se abrir\xe1 el selector de dispositivos."})]})})}),(0,r.jsxs)("div",{className:"mb-4",children:["waiting"===n&&(0,r.jsxs)("div",{className:"bg-blue-100 border border-blue-300 rounded-lg p-4 flex items-center gap-2",children:[(0,r.jsx)(c.A,{className:"w-5 h-5 text-blue-600"}),(0,r.jsx)("span",{className:"text-gray-700",children:"Esperando llamada del doctor..."})]}),"connecting"===n&&(0,r.jsxs)("div",{className:"bg-yellow-100 border border-yellow-300 rounded-lg p-4 flex items-center gap-2",children:[(0,r.jsx)(c.A,{className:"w-5 h-5 text-yellow-600"}),(0,r.jsxs)("span",{className:"text-gray-700",children:["Conectando con ",T,"..."]})]}),"connected"===n&&(0,r.jsxs)("div",{className:"bg-green-100 border border-green-300 rounded-lg p-4 flex items-center gap-2",children:[(0,r.jsx)(d.A,{className:"w-5 h-5 text-green-600"}),(0,r.jsxs)("span",{className:"text-gray-700",children:["En consulta con ",T]})]}),"ended"===n&&(0,r.jsxs)("div",{className:"bg-gray-100 border border-gray-300 rounded-lg p-4 flex items-center gap-2",children:[(0,r.jsx)(m.A,{className:"w-5 h-5 text-gray-600"}),(0,r.jsx)("span",{className:"text-gray-700",children:"Llamada finalizada"})]})]}),("connecting"===n||"connected"===n)&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[(0,r.jsxs)("div",{className:"relative bg-white rounded-xl shadow-lg overflow-hidden aspect-video",children:[(0,r.jsx)("video",{ref:V,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),"connecting"===n&&!S&&(0,r.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-white",children:[(0,r.jsx)(c.A,{className:"w-10 h-10 text-gray-400 mb-2 animate-spin"}),(0,r.jsx)("span",{className:"text-sm text-gray-500",children:"Esperando video del doctor..."})]}),(0,r.jsx)("div",{className:"absolute bottom-2 left-2 bg-black/50 text-white px-3 py-1 rounded",children:(0,r.jsx)("span",{className:"text-sm",children:T})})]}),(0,r.jsxs)("div",{className:"relative bg-white rounded-xl shadow-lg overflow-hidden aspect-video",children:[(0,r.jsx)("video",{ref:_,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover"}),(b||!(null==A?void 0:A.getVideoTracks().length))&&(0,r.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-gray-200",children:[(0,r.jsx)(h.A,{className:"w-12 h-12 text-gray-500 mb-2"}),(0,r.jsx)("span",{className:"text-sm text-gray-600",children:"C\xe1mara desactivada"}),(0,r.jsx)("button",{onClick:()=>P(!0),className:"mt-2 text-blue-600 hover:text-blue-800 underline text-sm",children:"Configurar c\xe1mara"})]}),(0,r.jsx)("div",{className:"absolute bottom-2 left-2 bg-black/50 text-white px-3 py-1 rounded",children:(0,r.jsx)("span",{className:"text-sm",children:"T\xfa"})})]})]}),(0,r.jsxs)("div",{className:"flex justify-center gap-4",children:[(0,r.jsx)("button",{onClick:()=>{if(A){let e=A.getAudioTracks()[0];e&&(e.enabled=!e.enabled,v(!e.enabled))}},className:"p-4 rounded-full transition-colors ".concat(f?"bg-red-600 hover:bg-red-700 text-white":"bg-white hover:bg-gray-100 text-gray-700 shadow-md"),children:f?(0,r.jsx)(x.A,{className:"w-6 h-6"}):(0,r.jsx)(g.A,{className:"w-6 h-6"})}),(0,r.jsx)("button",{onClick:()=>{if(A){let e=A.getVideoTracks()[0];e&&(e.enabled=!e.enabled,w(!e.enabled))}},className:"p-4 rounded-full transition-colors ".concat(b?"bg-red-600 hover:bg-red-700 text-white":"bg-white hover:bg-gray-100 text-gray-700 shadow-md"),children:b?(0,r.jsx)(h.A,{className:"w-6 h-6"}):(0,r.jsx)(p.A,{className:"w-6 h-6"})}),(0,r.jsx)("button",{onClick:Q,className:"p-4 bg-red-600 hover:bg-red-700 text-white rounded-full transition-colors shadow-md",children:(0,r.jsx)(m.A,{className:"w-6 h-6"})})]})]}),"waiting"===n&&(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-8 text-center",children:[(0,r.jsx)(y.A,{className:"w-24 h-24 text-gray-400 mx-auto mb-4"}),(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-700 mb-2",children:"Sala de Espera Virtual"}),(0,r.jsx)("p",{className:"text-gray-500",children:"Tu doctor te llamar\xe1 cuando est\xe9 listo para la consulta."}),(0,r.jsx)("p",{className:"text-sm text-gray-400 mt-4",children:"Por favor, mant\xe9n tu c\xe1mara y micr\xf3fono listos."}),O&&(0,r.jsxs)("div",{className:"mt-4 p-3 bg-yellow-100 border border-yellow-400 rounded-lg text-sm text-yellow-800",children:[(0,r.jsx)("p",{children:"⚠️ Problema detectado con la c\xe1mara."}),(0,r.jsx)("button",{onClick:()=>P(!0),className:"mt-2 text-blue-600 hover:text-blue-800 underline",children:"Configurar dispositivos manualmente"})]})]})]})})}function N(){let e=(0,n.useSearchParams)().get("room")||"demo-room";return(0,r.jsx)(w,{roomId:e,patientName:"Juan P\xe9rez"})}function k(){return(0,r.jsx)(s.Suspense,{fallback:(0,r.jsx)("div",{className:"flex items-center justify-center h-screen",children:"Cargando..."}),children:(0,r.jsx)(N,{})})}},5887:(e,a,t)=>{"use strict";t.d(a,{A:()=>r});let r=(0,t(9336).A)("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]])},6688:(e,a,t)=>{Promise.resolve().then(t.bind(t,5319))},6730:(e,a,t)=>{"use strict";t.d(a,{A:()=>r});let r=(0,t(9336).A)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},8348:(e,a,t)=>{"use strict";t.d(a,{A:()=>r});let r=(0,t(9336).A)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]])},9336:(e,a,t)=>{"use strict";t.d(a,{A:()=>l});var r=t(1111);let s=function(){for(var e=arguments.length,a=Array(e),t=0;t<e;t++)a[t]=arguments[t];return a.filter((e,a,t)=>!!e&&""!==e.trim()&&t.indexOf(e)===a).join(" ").trim()};var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let c=(0,r.forwardRef)((e,a)=>{let{color:t="currentColor",size:c=24,strokeWidth:l=2,absoluteStrokeWidth:i,className:o="",children:d,iconNode:u,...m}=e;return(0,r.createElement)("svg",{ref:a,...n,width:c,height:c,stroke:t,strokeWidth:i?24*Number(l)/Number(c):l,className:s("lucide",o),...m},[...u.map(e=>{let[a,t]=e;return(0,r.createElement)(a,t)}),...Array.isArray(d)?d:[d]])}),l=(e,a)=>{let t=(0,r.forwardRef)((t,n)=>{let{className:l,...i}=t;return(0,r.createElement)(c,{ref:n,iconNode:a,className:s("lucide-".concat(e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),l),...i})});return t.displayName="".concat(e),t}},9843:(e,a,t)=>{"use strict";t.d(a,{A:()=>r});let r=(0,t(9336).A)("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]])}},e=>{e.O(0,[554,829,358],()=>e(e.s=6688)),_N_E=e.O()}]);