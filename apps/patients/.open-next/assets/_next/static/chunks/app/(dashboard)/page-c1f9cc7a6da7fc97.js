(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[966],{1155:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>A});var s=l(3919),a=l(1111),r=l(7427),n=l(4515),i=l(811),o=l(7382),c=l(9843),d=l(979),x=l(1522);function m(e){let{videoRef:t,screenShareRef:l,localStream:a,screenStream:r,isVideoEnabled:n,cameraError:i,callStatus:o,onStartCall:c}=e;return(0,s.jsxs)("div",{className:"relative flex min-h-0 flex-1 overflow-hidden rounded-lg",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat blur-2xl scale-110",style:{backgroundImage:"url(/images/telemedicine-background.png)",filter:"brightness(0.4)"}}),(0,s.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-stone-900/80 via-stone-800/60 to-stone-900/80"}),(0,s.jsxs)("div",{className:"relative z-10 flex min-h-0 flex-1",children:[i?(0,s.jsx)(h,{error:i,onRetry:c}):a?(0,s.jsx)("video",{ref:t,className:"call-area__video h-full w-full object-cover transition-opacity ".concat(n?"opacity-100":"opacity-0"),autoPlay:!0,playsInline:!0,muted:!0}):(0,s.jsx)(u,{onStart:c}),"connecting"===o&&(0,s.jsx)(b,{}),r&&(0,s.jsx)("div",{className:"absolute right-4 top-4 hidden h-32 w-48 overflow-hidden rounded-lg border border-white/30 bg-black/50 shadow-lg sm:block backdrop-blur-sm z-20",children:(0,s.jsx)("video",{ref:l,className:"h-full w-full object-cover",autoPlay:!0,muted:!0,playsInline:!0})})]})]})}function u(e){let{onStart:t}=e;return(0,s.jsxs)("div",{className:"flex flex-1 flex-col items-center justify-center gap-4 bg-gradient-to-br from-stone-900 via-stone-800 to-stone-900 px-4 py-6 text-center",children:[(0,s.jsx)("div",{className:"flex h-24 w-24 items-center justify-center rounded-full bg-white/10 text-white/60 ring-2 ring-white/20",children:(0,s.jsx)(c.A,{className:"h-12 w-12"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-xl font-semibold text-white mb-2",children:"Videoconsulta"}),(0,s.jsx)("p",{className:"text-sm text-white/70 max-w-xs",children:"Inicia tu consulta m\xe9dica por video con tu especialista"})]}),(0,s.jsx)("button",{type:"button",onClick:t,className:"mt-2 rounded-lg bg-gradient-to-r from-stone-700 to-stone-600 hover:from-stone-600 hover:to-stone-500 px-6 py-3 text-sm font-semibold text-white transition-all shadow-lg hover:shadow-xl hover:scale-105",children:"Iniciar videoconsulta"})]})}function h(e){let{error:t,onRetry:l}=e;return(0,s.jsxs)("div",{className:"flex flex-1 flex-col items-center justify-center gap-3 bg-black/90 backdrop-blur-sm px-4 py-6 text-center text-white",children:[(0,s.jsx)("div",{className:"flex h-20 w-20 items-center justify-center rounded-full bg-red-500/20 text-red-400 ring-2 ring-red-500/50",children:(0,s.jsx)(d.A,{className:"h-10 w-10"})}),(0,s.jsx)("h3",{className:"text-xl font-semibold text-white",children:"No se detect\xf3 c\xe1mara"}),(0,s.jsx)("p",{className:"max-w-md text-sm text-white/70",children:t}),(0,s.jsx)("button",{type:"button",onClick:l,className:"mt-2 rounded-lg bg-white/20 hover:bg-white/30 px-5 py-2.5 text-sm font-semibold text-white transition backdrop-blur-sm border border-white/20",children:"Reintentar conexi\xf3n"})]})}function b(){return(0,s.jsxs)("div",{className:"absolute inset-0 flex h-full flex-col items-center justify-center gap-3 bg-black/70 text-white backdrop-blur-md",children:[(0,s.jsx)(x.A,{className:"h-10 w-10 animate-spin text-stone-400"}),(0,s.jsx)("p",{className:"text-sm font-medium",children:"Conectando videollamada…"}),(0,s.jsx)("p",{className:"text-xs text-white/60",children:"Esto puede tomar unos segundos"})]})}var f=l(3492),g=l(5887),p=l(3819),v=l(8650),j=l(8742),w=l(924);function N(e){let{isMuted:t,isVideoEnabled:l,isScreenSharing:a,showControls:r,isFocusMode:n,onToggleAudio:i,onToggleVideo:o,onToggleScreenShare:c,onEndCall:x}=e;return(0,s.jsx)("div",{className:"".concat(r?"opacity-100":"pointer-events-none opacity-0"," transition-opacity duration-300"),children:(0,s.jsxs)("div",{className:"flex flex-wrap items-center justify-center gap-3 rounded-full border border-white/20 bg-black/70 px-4 py-3 shadow-xl backdrop-blur-md sm:flex-nowrap sm:px-6",children:[(0,s.jsx)(y,{active:!t,iconActive:(0,s.jsx)(f.A,{className:"h-5 w-5"}),iconInactive:(0,s.jsx)(g.A,{className:"h-5 w-5"}),label:t?"Activar micr\xf3fono":"Silenciar",onClick:i,size:n?"sm":"md"}),(0,s.jsx)(y,{active:l,iconActive:(0,s.jsx)(p.A,{className:"h-5 w-5"}),iconInactive:(0,s.jsx)(d.A,{className:"h-5 w-5"}),label:l?"Ocultar video":"Mostrar video",onClick:o,size:n?"sm":"md"}),(0,s.jsx)(y,{active:a,iconActive:(0,s.jsx)(v.A,{className:"h-5 w-5"}),iconInactive:(0,s.jsx)(j.A,{className:"h-5 w-5"}),label:a?"Detener pantalla":"Compartir pantalla",onClick:c,size:n?"sm":"md"}),(0,s.jsx)("button",{type:"button",onClick:x,className:"flex items-center justify-center rounded-full bg-red-600 text-white transition-all hover:bg-red-500 hover:scale-110 ".concat(n?"h-10 w-10":"h-12 w-12"),"aria-label":"Terminar llamada",title:"Terminar llamada",children:(0,s.jsx)(w.A,{className:n?"h-4 w-4":"h-5 w-5"})})]})})}function y(e){let{active:t,iconActive:l,iconInactive:a,label:r,onClick:n,size:i="md"}=e;return(0,s.jsx)("button",{type:"button",onClick:n,className:"flex items-center justify-center rounded-full transition-all ".concat("sm"===i?"h-10 w-10":"h-12 w-12"," ").concat(t?"bg-stone-600 text-white shadow-lg shadow-stone-600/30 hover:bg-stone-500":"bg-white/20 text-white hover:bg-white/30 backdrop-blur-sm"),"aria-label":r,title:r,children:t?l:a})}var S=l(7717);function k(e){let{callStatus:t,callQuality:l,isScreenSharing:a,isFocusMode:r,showControls:n,showQualityOverlay:i,currentSession:o,formattedDuration:c,onToggleFocusMode:d}=e;return(0,s.jsxs)(s.Fragment,{children:[r&&o&&"live"===t&&n&&(0,s.jsx)("div",{className:"absolute left-4 top-4 z-10",children:(0,s.jsxs)("div",{className:"flex items-center gap-3 rounded-lg bg-black/70 px-3 py-2 backdrop-blur-md border border-white/20",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(S.A,{className:"h-4 w-4 text-green-400 animate-pulse"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"text-xs font-semibold text-white",children:["Dr. ",o.doctorName]}),(0,s.jsxs)("p",{className:"text-[10px] text-white/70",children:[o.appointmentType," • ",c||"00:00"]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-[10px] font-medium ".concat(l.color),children:l.label}),(0,s.jsx)("span",{className:"text-[10px] text-white/50",children:"• 45ms"})]})]})}),i&&"live"===t&&!r&&(0,s.jsx)("div",{className:"absolute top-4 left-4 transition-all duration-1000 ".concat(i?"translate-y-0 opacity-100":"-translate-y-2 opacity-0"),children:(0,s.jsxs)("div",{className:"flex items-center gap-2 rounded-lg border border-green-500/30 bg-green-500/10 px-3 py-2 text-xs backdrop-blur-md",children:[(0,s.jsx)("div",{className:"h-2 w-2 animate-pulse rounded-full bg-green-400"}),(0,s.jsxs)("span",{className:"font-medium text-green-200",children:[l.label," • 45ms • Estable"]})]})}),a&&(0,s.jsxs)("div",{className:"absolute bottom-4 right-4 flex items-center gap-2 rounded-full border border-white/20 bg-white/10 px-4 py-1.5 text-xs text-white backdrop-blur-md shadow-lg",children:[(0,s.jsx)(v.A,{className:"h-4 w-4"}),"Compartiendo pantalla"]}),(0,s.jsx)("div",{className:"absolute right-4 top-4",children:"live"===t&&(0,s.jsx)("button",{type:"button",onClick:d,className:"rounded-full border px-3 py-1.5 text-[11px] font-medium transition-all ".concat(r?"border-green-400/50 bg-green-500/20 text-green-200 hover:bg-green-500/30 shadow-lg shadow-green-500/20":"border-white/30 bg-black/50 text-white hover:border-green-400/60 hover:text-white backdrop-blur-md"),children:r?"✕ Salir modo foco":"\uD83C\uDFAF Modo foco"})})]})}function E(e){let{roomId:t="patient-room",sessionId:l,className:c=""}=e,d=(0,a.useRef)(null),x=(0,a.useRef)(null),{isFocusMode:u,setFocusMode:h}=(0,r.HW)(),{currentSession:b,formattedDuration:f}=(0,n.X)(),g=(0,i.T)(),p=(0,o.yI)(l),[v,j]=(0,a.useState)(!0),[w,y]=(0,a.useState)(!1),[S,E]=(0,a.useState)(null),C=(0,a.useMemo)(()=>g.cameraError?{label:"Sin conexi\xf3n",color:"text-red-400"}:"live"===g.callStatus?{label:"HD",color:"text-green-400"}:"connecting"===g.callStatus?{label:"Conectando",color:"text-yellow-400"}:{label:"En espera",color:"text-gray-400"},[g.cameraError,g.callStatus]);return(0,a.useEffect)(()=>{if("live"===g.callStatus){y(!0),h(!0);let e=setTimeout(()=>y(!1),3e3);return()=>clearTimeout(e)}h(!1)},[g.callStatus,h]),(0,a.useEffect)(()=>{if(!p.session)return;let e=async(e,t)=>{try{await p.logEvent(e,t)}catch(e){console.error("Error logging telemedicine event:",e)}};"live"===g.callStatus?e("call_started","Video call initiated successfully"):"ended"===g.callStatus&&e("call_ended","Video call ended by patient")},[g.callStatus,p]),(0,a.useEffect)(()=>{let e=()=>{j(!0),S&&clearTimeout(S),E(setTimeout(()=>{"live"===g.callStatus&&u&&j(!1)},3e3))};if(u)return window.addEventListener("mousemove",e),()=>{window.removeEventListener("mousemove",e),S&&clearTimeout(S)}},[u,g.callStatus,S]),(0,a.useEffect)(()=>{d.current&&g.localStream&&(d.current.srcObject=g.localStream)},[g.localStream]),(0,a.useEffect)(()=>{x.current&&g.screenStream&&(x.current.srcObject=g.screenStream)},[g.screenStream]),(0,s.jsxs)("div",{className:"flex min-h-0 flex-1 flex-col text-white ".concat(c),children:[(0,s.jsx)("div",{className:"call-area ".concat(u?"gap-3":"gap-4"," flex min-h-0 flex-1 flex-col lg:flex-row"),children:(0,s.jsx)("section",{className:"call-area__videoCard relative flex min-h-0 flex-1 flex-col",children:(0,s.jsxs)("div",{className:"relative flex min-h-0 flex-1 overflow-hidden rounded-lg",children:[(0,s.jsx)(m,{videoRef:d,screenShareRef:x,localStream:g.localStream,screenStream:g.screenStream,isVideoEnabled:g.isVideoEnabled,cameraError:g.cameraError,callStatus:g.callStatus,onStartCall:g.startCall}),(0,s.jsx)(k,{callStatus:g.callStatus,callQuality:C,isScreenSharing:g.isScreenSharing,isFocusMode:u,showControls:v,showQualityOverlay:w,currentSession:b,formattedDuration:f,onToggleFocusMode:()=>{h(!u)}}),(0,s.jsx)("div",{className:"absolute bottom-0 left-0 right-0 z-20 flex items-center justify-center pb-4",children:(0,s.jsx)(N,{isMuted:g.isMuted,isVideoEnabled:g.isVideoEnabled,isScreenSharing:g.isScreenSharing,showControls:v,isFocusMode:u,onToggleAudio:g.toggleAudio,onToggleVideo:g.toggleVideo,onToggleScreenShare:g.toggleScreenShare,onEndCall:g.endCall})})]})})}),u&&w&&(0,s.jsx)("div",{className:"pointer-events-none fixed inset-x-0 bottom-20 z-20 flex justify-center lg:hidden",children:(0,s.jsxs)("div",{className:"flex items-center gap-2 rounded-full border border-stone-500/30 bg-stone-500/10 px-4 py-2 text-xs text-stone-200 shadow-lg backdrop-blur-sm",children:[(0,s.jsx)("span",{className:"h-2 w-2 animate-pulse rounded-full bg-stone-400"}),"Video optimizado para consulta"]})})]})}var C=l(7741);function A(){return(0,s.jsxs)("div",{className:"flex h-screen w-full overflow-hidden bg-ivory-base",children:[(0,s.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden",children:[(0,s.jsx)("div",{className:"bg-white border-b border-stone-200 px-6 py-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-stone-900",children:"\xa1Hola, Mar\xeda! \uD83D\uDC4B"}),(0,s.jsx)("p",{className:"text-sm text-stone-600 mt-1",children:"Tu centro de telemedicina est\xe1 listo"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-green-50 border border-green-200 rounded-lg",children:[(0,s.jsx)("span",{className:"h-2 w-2 bg-green-500 rounded-full animate-pulse"}),(0,s.jsx)("span",{className:"text-xs font-medium text-green-700",children:"Disponible"})]}),(0,s.jsx)("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-blue-50 border border-blue-200 rounded-lg",children:(0,s.jsx)("span",{className:"text-xs font-medium text-blue-700",children:"Pr\xf3xima cita: Hoy 3:00 PM"})})]})]})}),(0,s.jsx)("div",{className:"flex-1 overflow-auto p-6",children:(0,s.jsx)("div",{className:"h-full flex items-center justify-center",children:(0,s.jsx)(E,{roomId:"patient-room-default",className:"w-full h-full"})})})]}),(0,s.jsx)(C.U,{context:"dashboard"})]})}},2610:(e,t,l)=>{Promise.resolve().then(l.bind(l,1155))},7427:(e,t,l)=>{"use strict";l.d(t,{HW:()=>n,VQ:()=>i});var s=l(3919),a=l(1111);let r=(0,a.createContext)(null);function n(){let e=(0,a.useContext)(r);if(!e)throw Error("usePatientPortal must be used within PatientPortalProvider");return e}function i(e){let{children:t}=e,[l,n]=(0,a.useState)(!1),[i,o]=(0,a.useState)(null),[c,d]=(0,a.useState)(!1);return(0,s.jsx)(r.Provider,{value:{isFocusMode:l,setFocusMode:n,activePanel:i,setActivePanel:o,isQuickActionsVisible:c,setQuickActionsVisible:d},children:t})}}},e=>{e.O(0,[613,896,91,129,678,438,216,382,554,829,358],()=>e(e.s=2610)),_N_E=e.O()}]);