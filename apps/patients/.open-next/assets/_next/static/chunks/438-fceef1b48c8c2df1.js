"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[438],{438:(e,t,a)=>{a.d(t,{OJ:()=>g,kT:()=>d,As:()=>I});let n={patient:"patients",doctor:"doctors",company:"companies",company_admin:"companies",organization_admin:"admin",admin:"admin",platform_admin:"admin"};var l=a(6588),o=a(4444);function i(){let e=o.env.NEXT_PUBLIC_NODE_ENV||"production";return"production"===e?"production":"staging"===e?"staging":"development"}function r(){return({production:{base:"pages.dev",cookie:".pages.dev",apps:{web:"https://autamedica-web-app.pages.dev",patients:"https://autamedica-patients.pages.dev",doctors:"https://autamedica-doctors.pages.dev",companies:"https://autamedica-companies.pages.dev",admin:"https://autamedica-admin.pages.dev"}},staging:{base:"pages.dev",cookie:".pages.dev",apps:{web:"https://autamedica-web-app-staging.pages.dev",patients:"https://autamedica-patients-staging.pages.dev",doctors:"https://autamedica-doctors-staging.pages.dev",companies:"https://autamedica-companies-staging.pages.dev",admin:"https://autamedica-admin-staging.pages.dev"}},development:{base:"localhost",cookie:"localhost",apps:{web:"http://localhost:3000",patients:"http://localhost:3003",doctors:"http://localhost:3002",companies:"http://localhost:3004",admin:"http://localhost:3005"}}})[i()]}let s=null;function d(){if(s)return s;let{url:e,anonKey:t}=function(){let e=i(),t="https://gtyvdircfhmdjiaelqkg.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd0eXZkaXJjZmhtZGppYWVscWtnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYyOTI3OTAsImV4cCI6MjA3MTg2ODc5MH0.7UFMVZsWTWOAynnhzkG76I_lhVCYtd_RmTt9EH3wJD4";if(!t||!a)throw Error("Supabase configuration is missing. Please set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY");return"development"===e&&t.includes("localhost:54321")?{url:"http://localhost:54321",anonKey:a}:{url:t,anonKey:a}}(),a={cookieName:"autamedica_session",cookieDomain:r().cookie,maxAge:2592e3,refreshThreshold:3600,rememberMeDuration:7776e3},n=r();return s=(0,l.createBrowserClient)(e,t,{cookies:{get(e){{let t=document.cookie.split("; ").find(t=>t.startsWith("".concat(e,"=")));return t?decodeURIComponent(t.split("=")[1]||""):void 0}},set(e,t,l){{let o=["".concat(e,"=").concat(encodeURIComponent(t)),"path=/","domain=".concat(n.cookie),"max-age=".concat(l.maxAge||a.maxAge),"SameSite=Lax","Secure"].filter(Boolean);document.cookie=o.join("; ")}},remove(e){[n.cookie,".".concat(n.base),n.base,"localhost"].forEach(t=>{document.cookie="".concat(e,"=; path=/; domain=").concat(t,"; expires=Thu, 01 Jan 1970 00:00:00 GMT")})}},auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"pkce",storage:{getItem:e=>{try{return window.localStorage.getItem(e)}catch(t){return window.sessionStorage.getItem(e)}},setItem:(e,t)=>{try{window.localStorage.setItem(e,t)}catch(a){window.sessionStorage.setItem(e,t)}},removeItem:e=>{try{window.localStorage.removeItem(e)}catch(t){window.sessionStorage.removeItem(e)}}}}})}var c=a(3919),u=a(1111);let p={PATIENT:"patient",DOCTOR:"doctor",COMPANY:"company",COMPANY_ADMIN:"company_admin",ORGANIZATION_ADMIN:"organization_admin",ADMIN:"admin",PLATFORM_ADMIN:"platform_admin"},m=Object.values(p),_={PATIENTS:"patients",DOCTORS:"doctors",COMPANIES:"companies",ADMIN:"admin"};p.PATIENT,_.PATIENTS,p.DOCTOR,_.DOCTORS,p.COMPANY,_.COMPANIES,p.COMPANY_ADMIN,_.COMPANIES,p.ORGANIZATION_ADMIN,_.ADMIN,p.ADMIN,_.ADMIN,p.PLATFORM_ADMIN,_.ADMIN,_.PATIENTS,p.PATIENT,_.DOCTORS,p.DOCTOR,_.COMPANIES,p.ORGANIZATION_ADMIN,_.ADMIN,p.PLATFORM_ADMIN;let h=(0,u.createContext)(void 0);function g(e){let{children:t,onAuthStateChange:a}=e,[l,o]=(0,u.useState)({user:null,profile:null,session:null,loading:!0,error:null}),[i,s]=(0,u.useState)(!1);(0,u.useEffect)(()=>{s(!0)},[]);let d=(0,u.useMemo)(()=>null,[i]);(0,u.useEffect)(()=>{if(i){let e="patient"===new URLSearchParams(window.location.search).get("as")?p.PATIENT:p.DOCTOR,t={id:"dev-".concat(e,"-1"),email:"".concat(e,"@dev.local"),user_metadata:{role:e},created_at:new Date().toISOString(),updated_at:new Date().toISOString()},a={id:t.id,email:t.email,role:e,first_name:"Dev",last_name:e===p.DOCTOR?"Doctor":"Patient",created_at:t.created_at,updated_at:t.updated_at,last_path:"/dashboard"};o({user:t,profile:a,session:{access_token:"dev-token",user:t},loading:!1,error:null});return}d&&(async()=>{try{let{data:{session:e},error:t}=await d.auth.getSession();if(t)throw t;if(e){let t=function(e){var t,a,n,l,o;let i=function(e){if("string"==typeof e){if(e===p.COMPANY_ADMIN)return p.ORGANIZATION_ADMIN;if("string"==typeof e&&m.includes(e))return e}return console.error("User does not have a role assigned"),null}(null==(t=e.user_metadata)?void 0:t.role);return i?{id:e.id,email:e.email,role:i,first_name:null==(a=e.user_metadata)?void 0:a.first_name,last_name:null==(n=e.user_metadata)?void 0:n.last_name,company_name:null==(l=e.user_metadata)?void 0:l.company_name,created_at:e.created_at,updated_at:e.updated_at||e.created_at,last_path:null!=(o=function(e){let t="autamedica_last_path_".concat(e);try{return localStorage.getItem(t)||sessionStorage.getItem(t)}catch(e){return null}}(e.id))?o:"/dashboard"}:null}(e.user);o({user:e.user,profile:t,session:e,loading:!1,error:null})}else o({user:null,profile:null,session:null,loading:!1,error:null})}catch(e){console.error("Failed to load session:",e),o({user:null,profile:null,session:null,loading:!1,error:e})}})()},[d,i]),(0,u.useEffect)(()=>{},[d,a,l.user]);let _=(0,u.useCallback)(async(e,t)=>{},[d]),g=(0,u.useCallback)(async e=>{},[d]),I=(0,u.useCallback)(async()=>{o({user:null,profile:null,session:null,loading:!1,error:null})},[l.user]),b=(0,u.useCallback)(async()=>{},[d]),f=(0,u.useCallback)(e=>{if(!l.profile)return void console.warn("Cannot redirect: no user profile");let t=function(e,t,a){let l=r(),o=n[e],i=function(e){if(!e)return null;let t=e.replace(/[<>'"]/g,"");return t.startsWith("/")||function(e){try{let t=r(),a=new URL(e,window.location.href);return Object.values(t.apps).some(e=>{let t=new URL(e);return a.hostname===t.hostname})}catch(e){return!1}}(t)?t:null}(t);if(i){if(i.startsWith("/")){let e=l.apps[o];return"".concat(e).concat(i)}return i}if(null==a?void 0:a.startsWith("/")){let e=l.apps[o];return"".concat(e).concat(a)}var s=e;let d=r(),c=n[s],u=d.apps[c];return"".concat(u).concat({"web-app":"/",patients:"/dashboard",doctors:"/dashboard",companies:"/dashboard",admin:"/dashboard"}[c])}(l.profile.role,e,l.profile.last_path);window.location.href=t},[l.profile]),A=(0,u.useCallback)(e=>{if(l.user){var t=l.user.id;let a="autamedica_last_path_".concat(t);try{localStorage.setItem(a,e)}catch(t){sessionStorage.setItem(a,e)}o(t=>({...t,profile:t.profile?{...t.profile,last_path:e}:null}))}},[l.user]),v={...l,signIn:_,signInWithMagicLink:g,signOut:I,refreshSession:b,redirectToRole:f,updateLastPath:A};return(0,c.jsx)(h.Provider,{value:v,children:t})}function I(){let e=(0,u.useContext)(h);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}a(1205),a(5129),a(4336),a(6220)},6220:(e,t,a)=>{var n=a(8850);n.Ik({id:n.Yj().uuid(),patient_id:n.Yj().uuid().nullable(),doctor_id:n.Yj().uuid().nullable(),start_time:n.Yj().datetime(),end_time:n.Yj().datetime().nullable(),duration_minutes:n.ai().int().positive().nullable(),type:n.k5(["consultation","follow_up","emergency","telemedicine","lab_test","checkup"]).nullable(),status:n.k5(["scheduled","confirmed","in-progress","completed","cancelled","no_show"]).nullable(),notes:n.Yj().nullable(),location:n.Yj().nullable(),meeting_url:n.Yj().url().nullable(),created_by:n.Yj().uuid().nullable(),created_at:n.Yj().datetime(),updated_at:n.Yj().datetime(),deleted_at:n.Yj().datetime().nullable()}).omit({id:!0,created_at:!0,updated_at:!0,deleted_at:!0}).partial(),n.Ik({user_id:n.Yj().uuid(),date_of_birth:n.Yj().nullable(),gender:n.k5(["male","female","other","prefer_not_to_say"]).nullable(),blood_type:n.k5(["A+","A-","B+","B-","AB+","AB-","O+","O-"]).nullable(),height_cm:n.ai().positive().nullable(),weight_kg:n.ai().positive().nullable(),medical_history:n.Yj().nullable(),allergies:n.Yj().nullable(),medications:n.Yj().nullable(),emergency_contact_name:n.Yj().nullable(),emergency_contact_phone:n.Yj().nullable(),insurance_provider:n.Yj().nullable(),insurance_policy_number:n.Yj().nullable(),created_at:n.Yj().datetime(),updated_at:n.Yj().datetime(),deleted_at:n.Yj().datetime().nullable()}).omit({created_at:!0,updated_at:!0,deleted_at:!0}).partial().omit({user_id:!0});let l=n.Ik({id:n.Yj().uuid(),company_id:n.Yj().uuid().nullable(),profile_id:n.Yj().uuid().nullable(),role:n.k5(["admin","manager","member","viewer"]).nullable(),position:n.Yj().nullable(),department:n.k5(["human_resources","finance","operations","sales","marketing","it","legal","other"]).nullable(),employee_id:n.Yj().nullable(),start_date:n.Yj().nullable(),end_date:n.Yj().nullable(),active:n.zM().nullable(),created_at:n.Yj().datetime().nullable(),updated_at:n.Yj().datetime().nullable(),deleted_at:n.Yj().datetime().nullable()});l.omit({id:!0,created_at:!0,updated_at:!0,deleted_at:!0}).extend({company_id:n.Yj().uuid(),profile_id:n.Yj().uuid()}),l.partial().omit({id:!0,company_id:!0,profile_id:!0,created_at:!0})}}]);