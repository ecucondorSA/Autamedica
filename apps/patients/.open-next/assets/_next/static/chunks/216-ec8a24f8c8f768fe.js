"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[216],{4216:(e,t,n)=>{n.d(t,{Ql:()=>b});var a=n(5129);class s{on(e,t){return this.eventListeners.has(e)||this.eventListeners.set(e,[]),this.eventListeners.get(e).push(t),()=>{this.off(e,t)}}off(e,t){let n=this.eventListeners.get(e);if(n){let e=n.indexOf(t);e>-1&&n.splice(e,1)}}emit(e){for(var t=arguments.length,n=Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];let s=this.eventListeners.get(e);s&&s.forEach(t=>{try{t(...n)}catch(t){console.error("Error in ".concat(e," listener:"),t)}})}setConnectionState(e){this.connectionState!==e&&(this.connectionState=e,this.emit("connection-state",e))}async connect(e){if("connecting"!==this.connectionState&&"connected"!==this.connectionState){this.setConnectionState("connecting");try{let t=e||this.config.roomId,n="".concat(this.config.signalingUrl,"?roomId=").concat(encodeURIComponent(t));this.ws=new WebSocket(n),this.ws.onopen=()=>{this.sendSignalingMessage({type:"join",from:this.config.userId,data:{userType:this.config.userType}})},this.ws.onmessage=e=>{this.handleSignalingMessage(JSON.parse(e.data))},this.ws.onerror=e=>{console.error("WebSocket error:",e),this.setConnectionState("failed"),this.emit("error",Error("WebSocket connection failed"))},this.ws.onclose=()=>{this.setConnectionState("disconnected"),this.cleanup()},await new Promise((e,t)=>{let n=setTimeout(()=>{t(Error("Connection timeout"))},1e4),a=this.ws.onopen;this.ws.onopen=t=>{clearTimeout(n),null==a||a.call(this.ws,t),e()};let s=this.ws.onerror;this.ws.onerror=e=>{clearTimeout(n),null==s||s.call(this.ws,e),t(Error("WebSocket connection failed"))}})}catch(e){throw this.setConnectionState("failed"),e}}}async startLocalStream(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{video:!0,audio:!0};try{for(let[,t]of(this.localStream=await navigator.mediaDevices.getUserMedia(e),this.emit("local-stream",this.localStream),this.peerConnections))this.attachLocalTracks(t.pc);return this.localStream}catch(e){throw console.error("Failed to get local stream:",e),this.emit("error",Error("Failed to access camera/microphone")),e}}stopLocalStream(){this.localStream&&(this.localStream.getTracks().forEach(e=>e.stop()),this.localStream=null)}async disconnect(){this.setConnectionState("disconnected"),this.ws&&(this.sendSignalingMessage({type:"leave"}),this.ws.close(),this.ws=null),this.cleanup()}cleanup(){for(let[,e]of this.peerConnections)e.pc.close();this.peerConnections.clear(),this.stopLocalStream()}sendSignalingMessage(e){this.ws&&this.ws.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify(e))}async handleSignalingMessage(e){switch(e.type){case"room-state":for(let t of e.data.users)this.emit("user-joined",t.id,t.userType);this.setConnectionState("connected");break;case"user-joined":this.emit("user-joined",e.from,e.data.userType),this.ensurePeerConnection(e.from);break;case"user-left":{this.emit("user-left",e.from);let t=this.peerConnections.get(e.from);t&&(t.pc.close(),this.peerConnections.delete(e.from));break}case"offer":await this.handleOffer(e.from,e.data);break;case"answer":await this.handleAnswer(e.from,e.data);break;case"ice-candidate":await this.handleIceCandidate(e.from,e.data);break;case"error":console.error("Signaling error:",e.data),this.emit("error",Error(e.data))}}ensurePeerConnection(e){let t=this.peerConnections.get(e);if(t)return t;let n=new RTCPeerConnection({iceServers:this.config.iceServers});return t={pc:n,pendingIceCandidates:[],isMakingOffer:!1,isSettingRemoteAnswerPending:!1,ignoreOffer:!1,isPolite:"doctor"!==this.config.userType},n.ontrack=t=>{var n;let a=null==(n=t.streams)?void 0:n[0];a&&this.emit("remote-stream",a,e)},n.onicecandidate=t=>{t.candidate&&this.sendSignalingMessage({type:"ice-candidate",to:e,data:t.candidate})},n.onconnectionstatechange=()=>{("failed"===n.connectionState||"closed"===n.connectionState)&&this.peerConnections.delete(e)},n.onnegotiationneeded=async()=>{if(t&&!t.isPolite)try{t.isMakingOffer=!0,await n.setLocalDescription(),n.localDescription&&this.sendSignalingMessage({type:"offer",to:e,data:n.localDescription})}catch(e){console.error("Failed to handle negotiationneeded:",e)}finally{t&&(t.isMakingOffer=!1)}},this.attachLocalTracks(n),this.peerConnections.set(e,t),t}attachLocalTracks(e){let t=this.localStream;if(!t)return;let n=new Set(e.getSenders().map(e=>{var t;return null==(t=e.track)?void 0:t.id}).filter(e=>!!e));t.getTracks().forEach(a=>{n.has(a.id)||e.addTrack(a,t)})}async handleOffer(e,t){let n=this.ensurePeerConnection(e),{pc:a}=n,s=n.isMakingOffer||"stable"!==a.signalingState;if(n.ignoreOffer=!n.isPolite&&s,n.ignoreOffer)return void console.warn("Ignoring offer due to collision (impolite peer)");try{s&&await a.setLocalDescription({type:"rollback"}),await a.setRemoteDescription(new RTCSessionDescription(t)),this.attachLocalTracks(a);let i=await a.createAnswer();await a.setLocalDescription(i),this.sendSignalingMessage({type:"answer",to:e,data:i}),await this.flushPendingIceCandidates(n),n.ignoreOffer=!1}catch(e){console.error("Failed to handle offer:",e)}}async handleAnswer(e,t){let n=this.peerConnections.get(e);if(n)try{n.isSettingRemoteAnswerPending=!0,await n.pc.setRemoteDescription(new RTCSessionDescription(t)),await this.flushPendingIceCandidates(n)}catch(e){console.error("Failed to handle answer:",e)}finally{n.isSettingRemoteAnswerPending=!1,n.ignoreOffer=!1}}async handleIceCandidate(e,t){let n=this.ensurePeerConnection(e),{pc:a}=n;if(a.remoteDescription)try{await a.addIceCandidate(new RTCIceCandidate(t))}catch(e){console.error("Failed to add ICE candidate:",e)}else n.pendingIceCandidates.push(t)}async flushPendingIceCandidates(e){if(e.pc.remoteDescription)for(;e.pendingIceCandidates.length>0;){let t=e.pendingIceCandidates.shift();try{await e.pc.addIceCandidate(new RTCIceCandidate(t))}catch(e){console.error("Failed to add queued ICE candidate:",e)}}}getConnectionState(){return this.connectionState}getLocalStream(){return this.localStream}getPeerConnections(){let e=new Map;for(let[t,n]of this.peerConnections)e.set(t,n.pc);return e}toggleVideo(e){if(!this.localStream)return!1;let t=this.localStream.getVideoTracks()[0];return!!t&&(t.enabled=void 0!==e?e:!t.enabled,t.enabled)}toggleAudio(e){if(!this.localStream)return!1;let t=this.localStream.getAudioTracks()[0];return!!t&&(t.enabled=void 0!==e?e:!t.enabled,t.enabled)}isVideoEnabled(){if(!this.localStream)return!1;let e=this.localStream.getVideoTracks()[0];return!!e&&e.enabled}isAudioEnabled(){if(!this.localStream)return!1;let e=this.localStream.getAudioTracks()[0];return!!e&&e.enabled}constructor(e){this.ws=null,this.peerConnections=new Map,this.localStream=null,this.eventListeners=new Map,this.connectionState="disconnected";let t=e.iceServers||function(){var e;let t=null!=(e=(0,a.DO)("NEXT_PUBLIC_ICE_SERVERS"))?e:(0,a.n8)("ICE_SERVERS_JSON","[]");try{return JSON.parse(t)}catch(e){return[]}}()||s.DEFAULT_ICE_SERVERS;this.config={signalingUrl:"wss://autamedica-signaling-server.ecucondor.workers.dev/signaling",iceServers:t,roomId:"default-room",...e}}}s.DEFAULT_ICE_SERVERS=[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"}];class i{on(e,t){this.eventListeners.has(e)||this.eventListeners.set(e,[]),this.eventListeners.get(e).push(t)}off(e,t){let n=this.eventListeners.get(e);if(n){let e=n.indexOf(t);e>-1&&n.splice(e,1)}}emit(e){for(var t=arguments.length,n=Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];let s=this.eventListeners.get(e);s&&s.forEach(t=>{try{t(...n)}catch(t){console.error("Error in ".concat(e," listener:"),t)}})}setConnectionState(e){this.connectionState!==e&&(this.connectionState=e,this.emit("connection-state",e))}async connect(e){if("connecting"!==this.connectionState&&"connected"!==this.connectionState){this.setConnectionState("connecting");try{var t;let n=e||this.config.roomId,a=await fetch("".concat(this.config.signalingUrl,"/api/join"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({roomId:n,userId:this.config.userId,userType:this.config.userType})});if(!a.ok)throw Error("Join failed: ".concat(a.status));let s=await a.json();if(!s.success)throw Error("Join failed: ".concat(s.error));if(null==(t=s.roomState)?void 0:t.users)for(let e of s.roomState.users)this.emit("user-joined",e.userId,e.userType);this.setConnectionState("connected"),this.startPolling()}catch(e){throw console.error("Connection failed:",e),this.setConnectionState("failed"),this.emit("error",e),e}}}async startLocalStream(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{video:!0,audio:!0};try{for(let[t,n]of(this.localStream=await navigator.mediaDevices.getUserMedia(e),this.emit("local-stream",this.localStream),this.peerConnections))this.localStream.getTracks().forEach(e=>{n.addTrack(e,this.localStream)});return this.localStream}catch(e){throw console.error("Failed to get local stream:",e),this.emit("error",Error("Failed to access camera/microphone")),e}}stopLocalStream(){this.localStream&&(this.localStream.getTracks().forEach(e=>e.stop()),this.localStream=null)}async disconnect(){if(this.setConnectionState("disconnected"),this.stopPolling(),this.config.roomId)try{await fetch("".concat(this.config.signalingUrl,"/api/leave"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({roomId:this.config.roomId,userId:this.config.userId})})}catch(e){console.error("Error leaving room:",e)}this.cleanup()}cleanup(){for(let[e,t]of this.peerConnections)t.close();this.peerConnections.clear(),this.stopLocalStream()}startPolling(){if(this.isPolling)return;this.isPolling=!0,this.lastPollTimestamp=Date.now();let e=async()=>{if(this.isPolling&&"connected"===this.connectionState){try{let e=await fetch("".concat(this.config.signalingUrl,"/api/poll?roomId=").concat(encodeURIComponent(this.config.roomId),"&userId=").concat(encodeURIComponent(this.config.userId),"&since=").concat(this.lastPollTimestamp),{method:"GET",headers:{"Content-Type":"application/json"}});if(e.ok){let t=await e.json();for(let e of(this.lastPollTimestamp=t.timestamp,t.messages))await this.handleSignalingMessage(e)}}catch(e){console.error("Polling error:",e)}this.pollTimer=window.setTimeout(e,this.config.pollInterval)}};e()}stopPolling(){this.isPolling=!1,null!==this.pollTimer&&(clearTimeout(this.pollTimer),this.pollTimer=null)}async sendSignalingMessage(e){try{let t=await fetch("".concat(this.config.signalingUrl,"/api/message"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({roomId:this.config.roomId,from:this.config.userId,...e})});if(!t.ok)throw Error("Failed to send message: ".concat(t.status))}catch(e){console.error("Failed to send signaling message:",e),this.emit("error",e)}}async handleSignalingMessage(e){switch(e.type){case"user-joined":var t;this.emit("user-joined",e.from,(null==(t=e.data)?void 0:t.userType)||"unknown"),this.localStream&&await this.createPeerConnection(e.from,!0);break;case"user-left":{this.emit("user-left",e.from);let t=this.peerConnections.get(e.from);t&&(t.close(),this.peerConnections.delete(e.from));break}case"offer":await this.handleOffer(e.from,e.data);break;case"answer":await this.handleAnswer(e.from,e.data);break;case"ice-candidate":await this.handleIceCandidate(e.from,e.data);break;default:console.warn("Unknown message type:",e.type)}}async createPeerConnection(e,t){let n=new RTCPeerConnection({iceServers:this.config.iceServers});if(this.localStream&&this.localStream.getTracks().forEach(e=>{n.addTrack(e,this.localStream)}),n.ontrack=t=>{var n;let a=null==(n=t.streams)?void 0:n[0];a&&this.emit("remote-stream",a,e)},n.onicecandidate=t=>{t.candidate&&this.sendSignalingMessage({type:"ice-candidate",to:e,data:t.candidate})},n.onconnectionstatechange=()=>{("failed"===n.connectionState||"closed"===n.connectionState)&&this.peerConnections.delete(e)},this.peerConnections.set(e,n),t){let t=await n.createOffer();await n.setLocalDescription(t),this.sendSignalingMessage({type:"offer",to:e,data:t})}return n}async handleOffer(e,t){let n=await this.createPeerConnection(e,!1);await n.setRemoteDescription(t);let a=await n.createAnswer();await n.setLocalDescription(a),this.sendSignalingMessage({type:"answer",to:e,data:a})}async handleAnswer(e,t){let n=this.peerConnections.get(e);n&&await n.setRemoteDescription(t)}async handleIceCandidate(e,t){let n=this.peerConnections.get(e);n&&await n.addIceCandidate(t)}getConnectionState(){return this.connectionState}getLocalStream(){return this.localStream}getPeerConnections(){return new Map(this.peerConnections)}toggleVideo(e){if(!this.localStream)return!1;let t=this.localStream.getVideoTracks()[0];return!!t&&(t.enabled=void 0!==e?e:!t.enabled,t.enabled)}toggleAudio(e){if(!this.localStream)return!1;let t=this.localStream.getAudioTracks()[0];return!!t&&(t.enabled=void 0!==e?e:!t.enabled,t.enabled)}isVideoEnabled(){if(!this.localStream)return!1;let e=this.localStream.getVideoTracks()[0];return!!e&&e.enabled}isAudioEnabled(){if(!this.localStream)return!1;let e=this.localStream.getAudioTracks()[0];return!!e&&e.enabled}async ping(){if("connected"===this.connectionState)try{await fetch("".concat(this.config.signalingUrl,"/api/ping"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:this.config.userId})})}catch(e){console.error("Ping failed:",e)}}constructor(e){this.peerConnections=new Map,this.localStream=null,this.eventListeners=new Map,this.connectionState="disconnected",this.pollTimer=null,this.lastPollTimestamp=0,this.isPolling=!1,this.config={signalingUrl:"https://autamedica-http-signaling-server.ecucondor.workers.dev",iceServers:i.DEFAULT_ICE_SERVERS,roomId:"default-room",pollInterval:1e3,...e}}}i.DEFAULT_ICE_SERVERS=[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"}];var r=n(3919),o=n(1111),c=n(5810),l=n(7737),d=n(7944),h=n(5209),g=n(5289),m=n(9048),u=n(3005),f=n(5629),p=n(6667),w=n(4385),S=n(6778);function b(e){var t,n;let{roomId:a,userId:i,userType:b,userName:y,onCallEnd:x,onCallStart:v,className:C="",theme:j="doctor"===b?"doctor":"patient"}=e,[k,T]=(0,o.useState)(null),[N,E]=(0,o.useState)("disconnected"),[I,P]=(0,o.useState)(!0),[A,O]=(0,o.useState)(!0),[L,D]=(0,o.useState)(!1),[M,R]=(0,o.useState)(new Map),[U,V]=(0,o.useState)(null),F=(0,o.useRef)(null),_=(0,o.useRef)(new Map),J=(0,o.useRef)(null),[W,z]=(0,o.useState)(null),q={doctor:{primary:"bg-[#ee58a6] hover:bg-[#d44a92]",accent:"text-[#ee58a6]",surface:"bg-[#101d32]",connected:"bg-emerald-500"},patient:{primary:"bg-[#4fd1c5] hover:bg-[#2c7a7b]",accent:"text-[#4fd1c5]",surface:"bg-[#161b22]",connected:"bg-[#4fd1c5]"}}[j];(0,o.useEffect)(()=>{let e=new s({userId:i,userType:b,roomId:a});return e.on("connection-state",e=>{E(e),"failed"===e?V("Error de conexi\xf3n. Verifica tu internet."):"connected"===e&&(V(null),null==v||v())}),e.on("local-stream",e=>{F.current&&(F.current.srcObject=e)}),e.on("remote-stream",(e,t)=>{R(n=>{let a=new Map(n),s=a.get(t)||{userId:t,userType:"unknown",userName:t};return a.set(t,{...s,stream:e}),a}),setTimeout(()=>{let n=_.current.get(t);n&&n.srcObject!==e&&(n.srcObject=e)},100)}),e.on("user-joined",(e,t)=>{R(n=>{let a=new Map(n),s=a.get(e);return a.set(e,{userId:e,userType:t,userName:e,stream:null==s?void 0:s.stream}),a})}),e.on("user-left",e=>{R(t=>{let n=new Map(t);return n.delete(e),n}),_.current.delete(e)}),e.on("error",e=>{console.error("[UnifiedVideoCall] WebRTC error:",e),V("Error de videollamada: ".concat(e.message))}),T(e),()=>{e.disconnect()}},[i,b,a]);let B=(0,o.useCallback)(async()=>{if(k&&"connected"!==N)try{V(null),await k.connect(a),await k.startLocalStream({video:{width:{ideal:1280},height:{ideal:720},frameRate:{ideal:30}},audio:!0}),P(!0),O(!0)}catch(t){console.error("[UnifiedVideoCall] Failed to start call:",t);let e=t instanceof Error?t.message:"Error desconocido";V("No se pudo iniciar la videollamada: ".concat(e))}},[k,a,N]),G=(0,o.useCallback)(async()=>{if(k)try{await k.disconnect(),W&&(W.getTracks().forEach(e=>e.stop()),z(null),D(!1)),null==x||x()}catch(e){console.error("[UnifiedVideoCall] Failed to end call:",e)}},[k,W,x]),Q=(0,o.useCallback)(()=>{k&&P(k.toggleVideo())},[k]),X=(0,o.useCallback)(()=>{k&&O(k.toggleAudio())},[k]),H=(0,o.useCallback)(async()=>{if(L){W&&(W.getTracks().forEach(e=>e.stop()),z(null),D(!1));return}try{let e=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!1});z(e),D(!0);let t=e.getVideoTracks()[0];t&&(t.onended=()=>{z(null),D(!1)})}catch(e){console.warn("[UnifiedVideoCall] Screen sharing cancelled:",e),D(!1)}},[L,W]);(0,o.useEffect)(()=>{M.forEach((e,t)=>{if(e.stream){let n=_.current.get(t);n&&n.srcObject!==e.stream&&(n.srcObject=e.stream)}})},[M]),(0,o.useEffect)(()=>{J.current&&W&&(J.current.srcObject=W)},[W]);let K=M.size+1;return(0,r.jsxs)("div",{className:"h-full flex flex-col ".concat(q.surface," text-white ").concat(C),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-800/90 border-b border-gray-700/60",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("div",{className:"w-3 h-3 rounded-full ".concat("connected"===N?q.connected:"connecting"===N?"bg-yellow-500":"bg-red-500")}),(0,r.jsx)("span",{className:"text-sm font-medium",children:"connected"===N?"Conectado":"connecting"===N?"Conectando...":"failed"===N?"Error de conexi\xf3n":"Desconectado"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-1 text-sm text-gray-400",children:[(0,r.jsx)(c.A,{className:"w-4 h-4"}),(0,r.jsxs)("span",{children:[K," ",1===K?"participante":"participantes"]})]}),y&&(0,r.jsxs)("div",{className:"text-sm text-gray-400",children:[y," (","doctor"===b?"Doctor":"Paciente",")"]})]}),(0,r.jsxs)("div",{className:"text-sm text-gray-400",children:["Sala: ",a]})]}),U&&(0,r.jsx)("div",{className:"bg-red-600/90 border-b border-red-500/60 px-4 py-2",children:(0,r.jsx)("p",{className:"text-sm text-white",children:U})}),(0,r.jsxs)("div",{className:"flex-1 p-4 relative",children:[(0,r.jsxs)("div",{className:"h-full grid gap-4 ".concat(0===M.size?"grid-cols-1":1===M.size?"grid-cols-2":M.size<=3?"grid-cols-2 grid-rows-2":"grid-cols-2 grid-rows-3"),children:[(0,r.jsxs)("div",{className:"relative bg-gray-800 rounded-lg overflow-hidden",children:["connected"===N?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("video",{ref:F,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover transition-opacity duration-300 ".concat(I?"opacity-100":"opacity-0")}),!I&&(0,r.jsx)("div",{className:"absolute inset-0 bg-gray-700 flex items-center justify-center",children:(0,r.jsx)(l.A,{className:"w-12 h-12 text-gray-400"})})]}):(0,r.jsx)("div",{className:"h-full flex items-center justify-center",children:"connecting"===N?(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)(d.A,{className:"w-8 h-8 animate-spin mx-auto mb-2 text-white/60"}),(0,r.jsx)("p",{className:"text-sm text-white/60",children:"Conectando..."})]}):(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)(h.A,{className:"w-12 h-12 mx-auto mb-2 text-white/40"}),(0,r.jsx)("p",{className:"text-sm text-white/60",children:"Tu video aparecer\xe1 aqu\xed"})]})}),(0,r.jsxs)("div",{className:"absolute bottom-2 left-2 bg-black/60 px-2 py-1 rounded text-sm backdrop-blur-sm",children:["T\xfa (","doctor"===b?"Doctor":"Paciente",")",!A&&(0,r.jsx)(g.A,{className:"inline w-4 h-4 ml-1 text-red-400"})]})]}),Array.from(M.entries()).map(e=>{let[t,n]=e;return(0,r.jsxs)("div",{className:"relative bg-gray-800 rounded-lg overflow-hidden",children:[(0,r.jsx)("video",{ref:e=>{e?(_.current.set(t,e),n.stream&&(e.srcObject=n.stream)):_.current.delete(t)},autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),(0,r.jsxs)("div",{className:"absolute bottom-2 left-2 bg-black/60 px-2 py-1 rounded text-sm backdrop-blur-sm",children:[n.userName||n.userId," (","doctor"===n.userType?"Doctor":"Paciente",")"]})]},t)}),0===M.size&&"connected"===N&&(0,r.jsx)("div",{className:"bg-gray-800 rounded-lg flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center text-gray-400",children:[(0,r.jsx)(c.A,{className:"w-12 h-12 mx-auto mb-2"}),(0,r.jsx)("p",{children:"Esperando a otros participantes..."})]})})]}),L&&W&&(0,r.jsxs)("div",{className:"absolute top-6 right-6 w-48 h-32 bg-black rounded-lg border-2 border-blue-500 overflow-hidden",children:[(0,r.jsx)("video",{ref:J,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-full object-contain"}),(0,r.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-2",children:(0,r.jsxs)("div",{className:"flex items-center text-xs text-white",children:[(0,r.jsx)(m.A,{className:"w-3 h-3 mr-1"}),"Compartiendo pantalla"]})})]})]}),(0,r.jsxs)("div",{className:"p-4 bg-gray-800/90 border-t border-gray-700/60",children:[(0,r.jsxs)("div",{className:"flex items-center justify-center space-x-4",children:[(0,r.jsx)("button",{onClick:Q,disabled:"connected"!==N,className:"p-3 rounded-full transition-colors disabled:opacity-50 disabled:cursor-not-allowed ".concat(I?"bg-gray-600 hover:bg-gray-500 text-white":"bg-red-600 hover:bg-red-500 text-white"),title:I?"Desactivar c\xe1mara":"Activar c\xe1mara",children:I?(0,r.jsx)(u.A,{className:"w-5 h-5"}):(0,r.jsx)(l.A,{className:"w-5 h-5"})}),(0,r.jsx)("button",{onClick:X,disabled:"connected"!==N,className:"p-3 rounded-full transition-colors disabled:opacity-50 disabled:cursor-not-allowed ".concat(A?"bg-gray-600 hover:bg-gray-500 text-white":"bg-red-600 hover:bg-red-500 text-white"),title:A?"Silenciar micr\xf3fono":"Activar micr\xf3fono",children:A?(0,r.jsx)(f.A,{className:"w-5 h-5"}):(0,r.jsx)(g.A,{className:"w-5 h-5"})}),"function"==typeof(null==(n=navigator)||null==(t=n.mediaDevices)?void 0:t.getDisplayMedia)&&(0,r.jsx)("button",{onClick:H,disabled:"connected"!==N,className:"p-3 rounded-full transition-colors disabled:opacity-50 disabled:cursor-not-allowed ".concat(L?"bg-blue-600 hover:bg-blue-500 text-white":"bg-gray-600 hover:bg-gray-500 text-white"),title:L?"Detener compartir pantalla":"Compartir pantalla",children:L?(0,r.jsx)(m.A,{className:"w-5 h-5"}):(0,r.jsx)(p.A,{className:"w-5 h-5"})}),"disconnected"===N||"failed"===N?(0,r.jsx)("button",{onClick:B,className:"p-4 ".concat(q.primary," rounded-full transition-colors text-white shadow-lg"),title:"Iniciar videollamada",children:(0,r.jsx)(w.A,{className:"w-6 h-6"})}):(0,r.jsx)("button",{onClick:G,className:"p-4 bg-red-600 hover:bg-red-500 rounded-full transition-colors text-white shadow-lg",title:"Terminar videollamada",children:(0,r.jsx)(S.A,{className:"w-6 h-6"})})]}),(0,r.jsxs)("div",{className:"text-center mt-3 text-sm text-gray-400",children:["disconnected"===N&&"Presiona el bot\xf3n para iniciar la videollamada","connecting"===N&&"Estableciendo conexi\xf3n...","connected"===N&&"Videollamada activa â€¢ ".concat(K," participante").concat(1!==K?"s":""),"failed"===N&&"Error de conexi\xf3n. Intenta nuevamente."]})]})]})}}}]);