"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[111],{111:(r,e,s)=>{s.d(e,{AuthProvider:()=>u,Z2:()=>c});var a=s(4296),n=s(3204),o=s(4209),t=s(7364),l=s(7301);let i=(0,n.createContext)(null),u=r=>{let{children:e,fallback:s=null,enableDebug:u=!1}=r,c=(()=>{let[r,e]=(0,n.useState)({user:null,session:null,loading:!0,error:null,initialized:!1}),s=(0,o.useRouter)(),a=(0,n.useMemo)(()=>(0,t.UZ)(),[]),l=(0,n.useCallback)((r,e)=>({message:r,code:e&&"object"==typeof e&&"code"in e?String(e.code):void 0,details:e}),[]),i=(0,n.useCallback)(r=>{e(e=>({...e,...r}))},[]);(0,n.useEffect)(()=>{if(!a)return;let r=!0;(async()=>{try{var e;let{data:{session:s},error:n}=await a.auth.getSession();if(!r)return;if(n)return void i({error:l("Failed to get session",n),loading:!1,initialized:!0});i({user:null!=(e=null==s?void 0:s.user)?e:null,session:s,loading:!1,error:null,initialized:!0})}catch(e){if(!r)return;i({error:l("Auth initialization failed",e),loading:!1,initialized:!0})}})();let{data:{subscription:e}}=a.auth.onAuthStateChange(async(e,a)=>{var n;if(r)switch(i({user:null!=(n=null==a?void 0:a.user)?n:null,session:a,loading:!1,error:null}),e){case"SIGNED_IN":s.refresh();break;case"SIGNED_OUT":s.push("/auth/select-role");break;case"TOKEN_REFRESHED":break;case"PASSWORD_RECOVERY":s.push("/auth/reset-password")}});return()=>{r=!1,e.unsubscribe()}},[a,s,l,i]);let u=(0,n.useCallback)(async(r,e)=>{i({loading:!0,error:null});try{let{data:s,error:n}=await a.auth.signInWithPassword({email:r.trim().toLowerCase(),password:e});if(n){let r=l("Invalid login credentials"===n.message?"Email o contrase�a incorrectos":n.message,n);return i({loading:!1,error:r}),{success:!1,error:r}}return i({user:s.user,session:s.session,loading:!1,error:null}),{success:!0}}catch(e){let r=l("Error de conexi�n",e);return i({loading:!1,error:r}),{success:!1,error:r}}},[a,l,i]),c=(0,n.useCallback)(async r=>{i({loading:!0,error:null});try{let{data:e,error:s}=await a.auth.signInWithOAuth({provider:r,options:{redirectTo:"".concat(window.location.origin,"/auth/callback"),queryParams:{access_type:"offline",prompt:"consent"}}});if(s){let e=l("Error con ".concat(r),s);return i({loading:!1,error:e}),{success:!1,error:e}}return{success:!0}}catch(e){let r=l("Error de autenticaci�n",e);return i({loading:!1,error:r}),{success:!1,error:r}}},[a,l,i]),d=(0,n.useCallback)(async()=>{i({loading:!0,error:null});try{let{error:r}=await a.auth.signOut();if(r){let e=l("Error al cerrar sesi�n",r);return i({loading:!1,error:e}),{success:!1,error:e}}return i({user:null,session:null,loading:!1,error:null}),{success:!0}}catch(e){let r=l("Error de conexi�n",e);return i({loading:!1,error:r}),{success:!1,error:r}}},[a,l,i]),g=(0,n.useCallback)(async(r,e,s)=>{i({loading:!0,error:null});try{var n;let{data:o,error:t}=await a.auth.signUp({email:r.trim().toLowerCase(),password:e,options:{data:null==s?void 0:s.data,emailRedirectTo:null!=(n=null==s?void 0:s.redirectTo)?n:"".concat(window.location.origin,"/auth/callback")}});if(t){let r=l(t.message.includes("already registered")?"Ya existe una cuenta con este email":t.message,t);return i({loading:!1,error:r}),{success:!1,error:r}}return i({user:o.user,session:o.session,loading:!1,error:null}),{success:!0}}catch(e){let r=l("Error al crear cuenta",e);return i({loading:!1,error:r}),{success:!1,error:r}}},[a,l,i]),h=(0,n.useCallback)(async r=>{i({loading:!0,error:null});try{let{error:e}=await a.auth.resetPasswordForEmail(r.trim().toLowerCase(),{redirectTo:"".concat(window.location.origin,"/auth/reset-password")});if(e){let r=l("Error al enviar email",e);return i({loading:!1,error:r}),{success:!1,error:r}}return i({loading:!1,error:null}),{success:!0}}catch(e){let r=l("Error de conexi�n",e);return i({loading:!1,error:r}),{success:!1,error:r}}},[a,l,i]),f=(0,n.useCallback)(async()=>{i({loading:!0,error:null});try{let{data:r,error:e}=await a.auth.refreshSession();if(e){let r=l("Error al actualizar sesi�n",e);return i({loading:!1,error:r}),{success:!1,error:r}}return i({user:r.user,session:r.session,loading:!1,error:null}),{success:!0}}catch(e){let r=l("Error de conexi�n",e);return i({loading:!1,error:r}),{success:!1,error:r}}},[a,l,i]),m=(0,n.useMemo)(()=>!!r.user&&!!r.session,[r.user,r.session]),w=(0,n.useCallback)(e=>{var s,a;return(null==(a=r.user)||null==(s=a.user_metadata)?void 0:s.role)===e},[r.user]);return{...r,supabase:a,isAuthenticated:m,hasRole:w,signIn:u,signInWithOAuth:c,signOut:d,signUp:g,resetPassword:h,refreshSession:f}})();n.useEffect(()=>{if(u&&(0,l.yz)()){var r,e;l.vF.info("AuthProvider state:",{user:null==(r=c.user)?void 0:r.id,loading:c.loading,error:null==(e=c.error)?void 0:e.message,initialized:c.initialized})}},[c.user,c.loading,c.error,c.initialized,u]);let d=(0,n.useMemo)(()=>c,[c]);return!c.initialized&&s?(0,a.jsx)(a.Fragment,{children:s}):(0,a.jsx)(i.Provider,{value:d,children:e})},c=()=>{let r=(0,n.useContext)(i);if(!r)throw Error("useAuthContext must be used within an AuthProvider. Make sure to wrap your component tree with <AuthProvider>.");return r}},4209:(r,e,s)=>{var a=s(2349);s.o(a,"useRouter")&&s.d(e,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(e,{useSearchParams:function(){return a.useSearchParams}})},7364:(r,e,s)=>{s.d(e,{UZ:()=>t});var a=s(5927),n=s(7301);let o=null,t=()=>{if(!o){let{url:r,anonKey:e}={url:(0,n.Ob)("NEXT_PUBLIC_SUPABASE_URL"),anonKey:(0,n.Ob)("NEXT_PUBLIC_SUPABASE_ANON_KEY")};o=(0,a.createBrowserClient)(r,e,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0,flowType:"pkce",debug:!1},realtime:{params:{eventsPerSecond:10}},global:{headers:{"X-Client-Info":"@autamedica/auth-app"}}}),window.addEventListener("beforeunload",()=>{null==o||o.removeAllChannels(),o=null})}return o}}}]);